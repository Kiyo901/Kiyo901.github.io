<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kiyoæ—¥è¯­ - AIæ²‰æµ¸å¼å®Œå…¨ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
     <!-- å¼•å…¥æ•°æ®æ–‡ä»¶ -->
    <script src="vocab.js"></script>        <!-- 1. æ ¸å¿ƒå•è¯ -->
    <script src="dict_vocab.js"></script>   <!-- 2. æ ‡å‡†å•è¯ (æ–°) -->
    <script src="dict_grammar.js"></script> <!-- 3. æ ‡å‡†è¯­æ³• (æ–°) -->
    <script src="basics.js"></script>       <!-- 4. åŸºç¡€çŸ¥è¯† (æ–°) -->
    <script src="data.js"></script>         <!-- 5. æ€»æ§æ•°æ® (å¿…é¡»æœ€å) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+SC:wght@400;700&family=M+PLUS+Rounded+1c:wght@400;700&display=swap');
        
        :root { --theme-primary: #f472b6; --theme-light: #fbcfe8; --theme-bg: #fff0f5; --theme-card-bg: #ffffff; --theme-text: #374151; --theme-pattern: radial-gradient(#fbcfe8 1.5px, transparent 1.5px); }
        body { font-family: 'M PLUS Rounded 1c', 'Noto Sans SC', sans-serif; background-color: var(--theme-bg); background-image: var(--theme-pattern); background-size: 24px 24px; color: var(--theme-text); transition: all 0.5s ease; overscroll-behavior: none; }
        
        .skin-text { color: var(--theme-primary); } .skin-bg { background-color: var(--theme-primary); } .skin-bg-light { background-color: var(--theme-light); } .skin-card-bg { background-color: var(--theme-card-bg); } .skin-border { border-color: var(--theme-light); } .skin-btn { background-color: var(--theme-primary); color: white; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .long-card { transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); } .long-card:hover { transform: scale(1.02); box-shadow: 0 10px 20px -5px rgba(0,0,0,0.1); }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } } .floating-icon { animation: float 3s ease-in-out infinite; }
        @keyframes pulse-custom { 0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 var(--theme-light); } 50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); } } .animate-pulse-custom { animation: pulse-custom 2s infinite; }
        @keyframes wiggle { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } } .animate-wiggle { animation: wiggle 2s ease-in-out infinite; }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 15px rgba(244, 114, 182, 0.5); } 50% { box-shadow: 0 0 25px rgba(244, 114, 182, 0.8); } }
        
        .msg-user { background: linear-gradient(to right, #f472b6, #fb7185); color: white; border-radius: 18px 18px 4px 18px; }
        .msg-ai { background: white; border: 1px solid #fce7f3; color: #374151; border-radius: 18px 18px 18px 4px; }
        .typing-dot { width: 6px; height: 6px; background: #9ca3af; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; } .typing-dot:nth-child(1) { animation-delay: -0.32s; } .typing-dot:nth-child(2) { animation-delay: -0.16s; } @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .rainbow-border { position: relative; z-index: 0; overflow: hidden; } .rainbow-border::before { content: ''; position: absolute; z-index: -2; left: -50%; top: -50%; width: 200%; height: 200%; background-repeat: no-repeat; background-size: 50% 50%, 50% 50%; background-position: 0 0, 100% 0, 100% 100%, 0 100%; background-image: linear-gradient(#399953, #399953), linear-gradient(#fbb300, #fbb300), linear-gradient(#d53e33, #d53e33), linear-gradient(#377af5, #377af5); animation: rotate 4s linear infinite; } .rainbow-border::after { content: ''; position: absolute; z-index: -1; left: 2px; top: 2px; width: calc(100% - 4px); height: calc(100% - 4px); background: white; border-radius: 1rem; } @keyframes rotate { 100% { transform: rotate(1turn); } }
        .noselect { user-select: none; -webkit-user-select: none; }
        .live-badge { animation: pulse-custom 1.5s infinite; }
        
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; }

        .timer-widget {
            position: fixed; left: 1rem; bottom: 1rem; z-index: 50;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border: 2px solid #fbcfe8;
            border-radius: 1rem;
            padding: 0.5rem 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            font-size: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            transition: all 0.3s;
        }
        .timer-widget:hover { transform: scale(1.05); }

        @media (max-width: 768px) {
            .timer-widget {
                left: auto; right: 0.5rem; bottom: auto; top: 5.5rem;
                flex-direction: row; align-items: center; gap: 0.5rem;
                padding: 0.3rem 0.6rem; border-radius: 2rem;
            }
            .timer-text-group { display: flex; gap: 5px; align-items: baseline; }
        }

        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 4px; }
        .status-active { background-color: #22c55e; box-shadow: 0 0 5px #22c55e; }
        .status-idle { background-color: #9ca3af; }

        /* æ’­æ”¾åŠ¨ç”» */
        .playing-wave { display: inline-flex; gap: 2px; align-items: flex-end; height: 12px; }
        .playing-wave span { width: 2px; background-color: white; animation: wave 1s infinite ease-in-out; }
        .playing-wave span:nth-child(1) { height: 4px; animation-delay: 0s; }
        .playing-wave span:nth-child(2) { height: 8px; animation-delay: 0.1s; }
        .playing-wave span:nth-child(3) { height: 6px; animation-delay: 0.2s; }
        @keyframes wave { 0%, 100% { height: 4px; } 50% { height: 12px; } }

        /* RPG ç‰¹æ•ˆ */
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
        .animate-shake { animation: shake 0.5s; }
        .rpg-damage-text { animation: float-up 1s forwards; }
        @keyframes float-up { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-30px); } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center relative overflow-x-hidden">

    <div id="app" :style="currentThemeStyle" class="w-full flex flex-col items-center min-h-screen">

        <!-- ç”µè„‘ç«¯å¹¿å‘Šä½ -->
        <div class="hidden xl:flex fixed left-4 top-1/2 -translate-y-1/2 w-32 h-[400px] border-2 border-dashed skin-border rounded-2xl items-center justify-center skin-card-bg bg-opacity-80 backdrop-blur-sm shadow-sm z-0">
            <div class="flex flex-col items-center gap-4 py-4 skin-text font-bold tracking-widest writing-vertical"><span class="text-xl">ğŸ™</span><span>Kiyoæ¨è</span><span class="text-xs opacity-60 font-normal">æ—¥è¯­å¥½ä¹¦</span><span class="text-xl">ğŸ™</span></div>
        </div>
        <div class="hidden xl:flex fixed right-4 top-1/2 -translate-y-1/2 w-32 h-[400px] border-2 border-dashed skin-border rounded-2xl items-center justify-center skin-card-bg bg-opacity-80 backdrop-blur-sm shadow-sm z-0">
            <div class="flex flex-col items-center gap-4 py-4 skin-text font-bold tracking-widest writing-vertical"><span class="text-xl">ğŸ±</span><span>ç•™å­¦å’¨è¯¢</span><span class="text-xs opacity-60 font-normal">åæ ¡ç›´é€š</span><span class="text-xl">ğŸ±</span></div>
        </div>

        <!-- è®¡æ—¶å™¨ -->
        <div v-if="currentView !== 'shop'" class="timer-widget">
            <div class="flex items-center font-bold text-gray-700 mb-1 md:mb-0">
                <span class="status-dot" :class="isIdle ? 'status-idle' : 'status-active'"></span>
                <span class="md:inline hidden">{{ isIdle ? 'ğŸ’¤ æŒ‚æœºä¸­' : 'ğŸ”¥ å­¦ä¹ ä¸­' }}</span>
                <span class="md:hidden inline">{{ isIdle ? 'ğŸ’¤' : 'ğŸ”¥' }}</span>
            </div>
            <div class="text-xs text-gray-500 timer-text-group">
                <span v-if="!hasClaimedDailyReward">{{ formatTime(todayTime) }} <span class="hidden md:inline">/ 30:00</span></span>
                <span v-else class="text-green-500 font-bold">ğŸ‰ <span class="hidden md:inline">è¾¾æˆ</span></span>
                <span class="text-[10px] text-gray-400 md:mt-1 md:block">
                    <span class="hidden md:inline">è¿ç»­:</span> <span class="text-pink-500 font-bold">{{ learningStreak }}</span> å¤©
                </span>
            </div>
        </div>

        <!-- ğŸš€ ä¸»å®¹å™¨ -->
        <div class="w-full md:max-w-4xl lg:max-w-6xl min-h-screen flex flex-col skin-card-bg bg-opacity-95 shadow-2xl backdrop-blur-md md:my-6 md:rounded-[3rem] overflow-hidden border-2 border-white/20 relative z-10 transition-all duration-500">
            <div class="h-2 w-full skin-bg transition-colors duration-500"></div>

            <!-- Header -->
            <div class="pt-6 pb-4 px-6 md:px-10 flex justify-between items-start z-20">
                <div class="flex flex-col">
                    <h1 class="text-2xl md:text-3xl font-bold flex items-center gap-2 transition-colors duration-500">
                        <span class="text-3xl md:text-4xl floating-icon">{{ activeTheme.icon }}</span> Kiyoæ—¥è¯­
                    </h1>
                    <div class="mt-3 flex items-center gap-3">
                        <div class="bg-gray-100 px-3 py-1.5 rounded-full flex items-center gap-1 border border-gray-200" :class="{'ring-2 ring-yellow-400': isVIP}">
                            <i v-if="isVIP" class="fas fa-crown text-yellow-500"></i>
                            <i v-else class="fas fa-coins text-yellow-500"></i>
                            <span class="text-sm font-bold text-gray-600">{{ userCoins }}</span>
                        </div>
                        <div class="bg-pink-50 px-3 py-1.5 rounded-full flex items-center gap-1 border border-pink-100">
                            <span class="text-lg">ğŸŒ¸</span>
                            <span class="text-sm font-bold text-pink-500">{{ userSakuras }}</span>
                        </div>
                        <button @click="currentView = 'shop'" class="animate-wiggle relative bg-gradient-to-r from-yellow-400 to-orange-400 text-white px-4 py-1.5 rounded-full font-bold text-sm shadow-lg hover:shadow-xl transition-all transform hover:scale-105 flex items-center gap-1 border-2 border-white">
                            <i class="fas fa-store"></i> å•†åº— <span class="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] px-1.5 py-0.5 rounded-full border border-white animate-pulse">SALE</span>
                        </button>
                    </div>
                </div>
                
                <!-- ğŸ”´ å³ä¾§æŒ‰é’®ç»„ (ç­¾åˆ° + èµé‡‘) -->
                <div class="flex gap-2">
                    <button @click="showActivityModal = true" class="group flex flex-col items-center justify-center skin-card-bg border-2 skin-border rounded-2xl w-14 h-14 md:w-16 md:h-16 shadow-sm hover:shadow-md transition-all active:scale-95 relative">
                        <div class="text-center">
                            <span class="text-2xl block -mt-1">ğŸ</span>
                            <span class="block text-[10px] opacity-60 mt-0.5">èµé‡‘</span>
                        </div>
                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white animate-pulse"></div>
                    </button>
                    <button @click="openCheckIn" class="group flex flex-col items-center justify-center skin-card-bg border-2 skin-border rounded-2xl w-14 h-14 md:w-16 md:h-16 shadow-sm hover:shadow-md transition-all active:scale-95">
                        <div v-if="!hasCheckedInToday" class="text-center"><i class="fas fa-calendar-check skin-text text-xl group-hover:scale-110 transition-transform"></i><span class="block text-[10px] opacity-60 mt-0.5">ç­¾åˆ°</span></div>
                        <div v-else class="text-center"><span class="text-2xl block -mt-1">ğŸ’®</span><span class="block text-[10px] skin-text font-bold -mt-1">å·²ç­¾</span></div>
                    </button>
                </div>
            </div>

            <!-- === è§†å›¾: é¦–é¡µ === -->
            <div v-if="currentView === 'home'" class="flex-1 px-6 md:px-10 pb-10 flex flex-col">
                <div @click="showAnnouncementModal = true" class="w-full mb-4 flex justify-between items-center bg-gradient-to-r from-orange-50 to-yellow-50 border border-yellow-200 rounded-xl p-3 shadow-sm cursor-pointer hover:shadow-md transition-all relative overflow-hidden group">
                    <div class="absolute left-0 top-0 w-1 h-full bg-yellow-400"></div>
                    <div class="flex items-center gap-3">
                        <div class="bg-yellow-100 text-yellow-600 rounded-full w-8 h-8 flex items-center justify-center animate-pulse-custom"><i class="fas fa-bell"></i></div>
                        <div class="flex flex-col"><span class="font-bold text-gray-700 text-sm flex items-center gap-2">ç³»ç»Ÿå…¬å‘Š / ãŠçŸ¥ã‚‰ã› <span class="bg-red-500 text-white text-[8px] px-1.5 rounded-full animate-pulse">NEW</span></span><span class="text-[10px] text-gray-400">æ–°äººå¿…è¯»ï¼é˜²æ­¢è€å©†èµ°å¤±...</span></div>
                    </div>
                    <div class="text-gray-300"><i class="fas fa-chevron-right"></i></div>
                </div>

                <div class="flex justify-center mb-4">
                    <div class="skin-card-bg p-1 rounded-full shadow-sm flex gap-2 border border-gray-100">
                        <button v-for="level in levels" :key="level" @click="selectLevel(level)" :class="{'skin-bg text-white shadow-sm active': currentLevel === level, 'opacity-50 hover:opacity-100': currentLevel !== level, 'cursor-not-allowed bg-gray-100': isLevelLocked(level) && currentLevel !== level}" class="w-8 h-8 rounded-full flex items-center justify-center text-xs transition-all font-bold relative">{{ level }}<div v-if="isLevelLocked(level)" class="absolute -top-1 -right-1 bg-gray-500 text-white w-3 h-3 rounded-full flex items-center justify-center shadow-sm" style="font-size: 6px;"><i class="fas fa-lock"></i></div></button>
                    </div>
                </div>

                <div @click="toggleQuote" class="relative w-full rounded-2xl shadow-md overflow-hidden text-white flex flex-col justify-between transition-all duration-500 cursor-pointer border-2 border-white group" :class="isQuoteExpanded ? 'mb-6 p-6 min-h-[220px]' : 'mb-4 p-3 min-h-[60px] h-[60px] hover:scale-[1.01]'" style="background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);">
                    <div v-if="!isQuoteExpanded" class="flex items-center justify-between h-full px-2">
                        <div class="flex items-center gap-2 text-sm font-bold"><i class="fas fa-quote-left opacity-60"></i> <span>ä»Šæ—¥æ—¥ç­¾ (ç‚¹å‡»å±•å¼€)</span></div><div class="text-xs opacity-80">{{ currentDateStr }}</div>
                    </div>
                    <div v-else class="h-full flex flex-col justify-between relative z-10">
                        <div class="absolute top-0 right-0 animate-bounce"><i class="fas fa-volume-up text-xl opacity-80"></i></div>
                        <div class="flex justify-between items-center relative z-10 mb-2 opacity-90"><div class="flex items-center gap-2 font-bold tracking-widest text-lg"><span class="text-2xl">ğŸŒ¸</span> Kiyoæ—¥è¯­</div><div class="text-xs font-mono bg-white/20 px-2 py-0.5 rounded-lg border border-white/30">{{ currentDateStr }}</div></div>
                        <div class="relative z-10 text-center flex-1 flex flex-col justify-center my-2"><h3 class="text-xl md:text-2xl font-bold mb-3 font-serif leading-relaxed drop-shadow-md">"{{ todayQuote.ja }}"</h3><p class="text-sm md:text-base opacity-90 font-light tracking-wide bg-black/10 py-1 px-4 rounded-full mx-auto w-max backdrop-blur-sm border border-white/10">{{ todayQuote.cn }}</p></div>
                        <div class="flex justify-between items-end relative z-10 mt-4 bg-white/10 p-3 rounded-2xl backdrop-blur-md border border-white/20"><div class="flex flex-col"><div class="text-[10px] text-blue-100 mb-0.5 flex items-center gap-1"><i class="fas fa-fire text-yellow-300"></i> å·²è¿ç»­è‡ªå¾‹</div><div class="text-3xl font-black text-white leading-none font-mono" style="text-shadow: 0 2px 4px rgba(0,0,0,0.2);">{{ learningStreak }} <span class="text-xs font-normal opacity-70">å¤©</span></div></div><div class="flex items-center gap-3"><div class="text-right hidden xs:block"><div class="text-xs font-bold">kiyo-jp.com</div><div class="text-[8px] opacity-70">æ‰«ç åŠ å…¥æ—¥è¯­æŒ‘æˆ˜ â”</div></div><div class="w-12 h-12 bg-white rounded-lg p-1 flex items-center justify-center shadow-lg"><i class="fas fa-qrcode text-3xl text-gray-800"></i></div></div></div>
                    </div>
                </div>

                <div @click="enterModule('chat')" class="mb-6 bg-white rounded-[2.5rem] p-1 shadow-xl cursor-pointer hover:scale-[1.01] transition-all relative overflow-hidden group border-2 border-indigo-100" style="animation: glow 3s infinite alternate;">
                    <div class="bg-gradient-to-r from-violet-600 to-indigo-600 rounded-[2.2rem] h-32 md:h-40 p-6 flex items-center justify-between relative overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20 animate-pulse-custom"></div>
                        <div class="flex flex-col text-white z-10 relative h-full justify-center"><div class="flex items-center gap-2 mb-1"><span class="bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full live-badge">LIVE</span><span class="text-yellow-300 text-xs font-bold tracking-widest">24H åœ¨çº¿</span></div><span class="text-2xl md:text-3xl font-bold flex items-center gap-2 text-shadow-sm">ğŸ§â€â™€ï¸ AI æ²‰æµ¸å¼ä¼´ä¾£ç§æ•™</span><span class="text-xs md:text-sm opacity-90 mt-2 bg-white/10 px-3 py-1 rounded-full w-max border border-white/20 backdrop-blur-sm">ä¸€å¯¹ä¸€çº éŸ³ Â· æƒ…æ„Ÿé™ªä¼´ Â· å‰§æƒ…è§£é”</span></div>
                        <div class="relative z-10 mr-2"><div class="w-20 h-20 md:w-24 md:h-24 rounded-full bg-white border-4 border-indigo-200 flex items-center justify-center text-5xl shadow-2xl group-hover:scale-110 transition-transform duration-500">ğŸ‘©â€ğŸ«<div class="absolute bottom-0 right-0 w-6 h-6 bg-green-400 border-2 border-white rounded-full"></div></div></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-20">
                    <!-- ğŸ—¼ è¯æ±‡å®å…¸ -->
                    <div @click="enterModule('vocab')" class="h-32 bg-gradient-to-br from-red-500 via-red-600 to-red-400 rounded-[2rem] p-6 flex items-center justify-between cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all relative overflow-hidden group shadow-lg border-2 border-white/30">
                        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/diamond-upholstery.png')]"></div>
                        <div class="flex items-center gap-5 z-10 text-white">
                            <div class="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center text-4xl shadow-inner border border-white/20 group-hover:rotate-12 transition-transform">ğŸ—¼</div>
                            <div>
                                <div class="font-bold text-2xl drop-shadow-md">Kiyo è¯æ±‡å®å…¸</div>
                                <div class="text-xs bg-white/20 px-2 py-0.5 rounded-full inline-block mt-1 border border-white/20 backdrop-blur-sm">TOKYO TOWER</div>
                                <div class="text-[10px] mt-1 opacity-90">ä¸¥é€‰å¿…è€ƒ + æ ‡å‡†å…¨åº“</div>
                            </div>
                        </div>
                        <div class="absolute -right-6 -bottom-6 w-32 h-32 bg-yellow-400 rounded-full blur-3xl opacity-30"></div>
                        <i class="fas fa-chevron-right text-white/50 text-2xl group-hover:translate-x-1 transition-transform z-10"></i>
                    </div>

                    <!-- ğŸ¯ æ–‡æ³•å·è½´ -->
                    <div @click="enterModule('grammar')" class="h-32 bg-gradient-to-br from-blue-500 via-blue-600 to-blue-400 rounded-[2rem] p-6 flex items-center justify-between cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all relative overflow-hidden group shadow-lg border-2 border-white/30">
                        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/asfalt-light.png')]"></div>
                        <div class="flex items-center gap-5 z-10 text-white">
                            <div class="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center text-4xl shadow-inner border border-white/20 group-hover:-rotate-12 transition-transform">ğŸ¯</div>
                            <div>
                                <div class="font-bold text-2xl drop-shadow-md">Kiyo æ–‡æ³•å·è½´</div>
                                <div class="text-xs bg-white/20 px-2 py-0.5 rounded-full inline-block mt-1 border border-white/20 backdrop-blur-sm">KYOTO TOWER</div>
                                <div class="text-[10px] mt-1 opacity-90">æ ¸å¿ƒè¯­æ³• + è¿›é˜¶ä½“ç³»</div>
                            </div>
                        </div>
                        <div class="absolute -right-6 -bottom-6 w-32 h-32 bg-cyan-400 rounded-full blur-3xl opacity-30"></div>
                        <i class="fas fa-chevron-right text-white/50 text-2xl group-hover:translate-x-1 transition-transform z-10"></i>
                    </div>

                    <div @click="enterModule('quiz', 'vocab')" class="h-24 bg-gradient-to-br from-orange-50 to-orange-100 border-2 border-orange-200 rounded-[2rem] p-5 flex items-center justify-between cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all relative overflow-hidden group col-span-1 md:col-span-2"><div class="absolute -right-6 -top-6 w-24 h-24 bg-orange-200 rounded-full opacity-50 blur-xl"></div><div class="flex items-center gap-4 z-10"><div class="w-12 h-12 rounded-2xl bg-white text-orange-500 flex items-center justify-center text-2xl shadow-sm group-hover:scale-110 transition-transform">ğŸ“</div><div><div class="font-bold text-gray-800 text-lg">çœŸé¢˜å®æˆ˜æ¼”ç»ƒ</div><div class="flex gap-1 mt-1"><span class="text-[9px] bg-white px-1.5 py-0.5 rounded text-orange-600 border border-orange-100">è¯æ±‡</span><span class="text-[9px] bg-white px-1.5 py-0.5 rounded text-orange-600 border border-orange-100">è¯­æ³•</span><span class="text-[9px] bg-white px-1.5 py-0.5 rounded text-orange-600 border border-orange-100">é˜…è¯»</span><span class="text-[9px] bg-white px-1.5 py-0.5 rounded text-orange-600 border border-orange-100">å¬åŠ›</span></div></div></div><div class="w-8 h-8 rounded-full bg-white/50 flex items-center justify-center text-orange-400"><i class="fas fa-arrow-right"></i></div></div>
                    
                    <!-- ğŸ“– åŸºç¡€çŸ¥è¯† (ç»Ÿä¸€å…¥å£) -->
                    <div @click="currentView = 'basics'" class="h-24 bg-white border-2 skin-border rounded-[2rem] p-5 flex items-center justify-between cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all relative overflow-hidden group col-span-1 md:col-span-2">
                        <div class="flex items-center gap-4 z-10">
                            <div class="w-12 h-12 rounded-2xl bg-emerald-50 text-emerald-500 flex items-center justify-center text-2xl shadow-sm group-hover:scale-110 transition-transform">ğŸ“–</div>
                            <div>
                                <div class="font-bold text-gray-800 text-lg">åŸºç¡€çŸ¥è¯† / å…¥é—¨</div>
                                <div class="text-[10px] text-gray-400 mt-1">äº”åéŸ³å›¾ Â· æ•°å­— Â· æ—¶é—´æ—¥æœŸ</div>
                            </div>
                        </div>
                        <div class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-300"><i class="fas fa-arrow-right"></i></div>
                    </div>

                    <div @click="enterModule('review')" class="h-24 bg-white border-2 skin-border rounded-[2rem] p-5 flex items-center justify-between cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all relative overflow-hidden group col-span-1 md:col-span-2"><div class="flex items-center gap-4"><div class="w-12 h-12 rounded-2xl bg-red-50 text-red-400 flex items-center justify-center text-2xl group-hover:rotate-12 transition-transform">ğŸ“’</div><div><div class="font-bold text-gray-800 text-lg">æ™ºèƒ½é”™é¢˜æœ¬</div><div class="text-[10px] text-gray-400">æŸ¥æ¼ Â· è¡¥ç¼º</div></div></div><i class="fas fa-chevron-right text-gray-300"></i></div>
                    
                    <!-- ğŸ“º è¿½ç•ªå­¦ä¹  -->
                    <div @click="alert('ğŸš§ åŠŸèƒ½å‡çº§ä¸­ï¼š\næ­£åœ¨æ¥å…¥Bç«™/Netflix API...\næˆ‘ä»¬å°†ä¸ºæ‚¨ç²¾é€‰é€‚åˆN5-N1ä¸åŒç­‰çº§çš„åŠ¨æ¼«ç‰‡æ®µï¼\næ•¬è¯·æœŸå¾…ï¼')" class="h-28 bg-pink-100 rounded-[2rem] p-6 flex items-center justify-between cursor-pointer hover:shadow-xl hover:scale-[1.01] transition-all relative overflow-hidden group col-span-1 md:col-span-2 lg:col-span-4 mt-2 border-4 border-white/20 shadow-lg"><div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div><div class="absolute -right-10 -bottom-10 w-40 h-40 bg-purple-200 rounded-full blur-3xl opacity-50 animate-pulse"></div><div class="flex items-center gap-5 z-10 text-gray-700 relative"><div class="w-14 h-14 rounded-2xl bg-white/40 backdrop-blur-sm flex items-center justify-center text-3xl shadow-inner border border-white/30 group-hover:scale-110 transition-transform"><i class="fas fa-play text-pink-500"></i></div><div><div class="font-bold text-xl md:text-2xl text-shadow-sm flex items-center gap-2">ğŸ“º æ²‰æµ¸å¼è¿½ç•ªå­¦æ—¥è¯­ <span class="text-[10px] bg-pink-500 text-white px-2 py-0.5 rounded-full border border-pink-300">Coming Soon</span></div><div class="text-xs opacity-90 bg-white/40 px-3 py-1 rounded-full w-max mt-1 border border-white/10 text-gray-600">è¾¹çœ‹ç•ª Â· è¾¹å­¦æ—¥è¯­ Â· å®æ—¶å­—å¹•è§£æ</div></div></div><div class="text-gray-400 text-2xl group-hover:translate-x-1 transition-transform z-10"><i class="fas fa-chevron-right"></i></div></div>

                    <!-- ğŸ® æ¸¸æˆå­¦ä¹  -->
                    <div @click="currentView = 'game'" class="h-28 bg-pink-100 rounded-[2rem] p-6 flex items-center justify-between cursor-pointer hover:shadow-xl hover:scale-[1.01] transition-all relative overflow-hidden group col-span-1 md:col-span-2 lg:col-span-4 mt-2 border-4 border-white/20 shadow-lg"><div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div><div class="absolute -right-10 -bottom-10 w-40 h-40 bg-purple-200 rounded-full blur-3xl opacity-50 animate-pulse"></div><div class="flex items-center gap-5 z-10 text-gray-700 relative"><div class="w-14 h-14 rounded-2xl bg-white/40 backdrop-blur-sm flex items-center justify-center text-3xl shadow-inner border border-white/30 group-hover:scale-110 transition-transform"><i class="fas fa-gamepad text-pink-500"></i></div><div><div class="font-bold text-xl md:text-2xl text-shadow-sm flex items-center gap-2">ğŸ® å¼‚ä¸–ç•Œæ—¥è¯­å†’é™© <span class="text-[10px] bg-pink-500 text-white px-2 py-0.5 rounded-full border border-pink-300 animate-pulse">NEW</span></div><div class="text-xs opacity-90 bg-white/40 px-3 py-1 rounded-full w-max mt-1 border border-white/10 text-gray-600">RPGç©æ³• Â· å•è¯æˆ˜æ–— Â· å‰§æƒ…æ”»ç•¥</div></div></div><div class="text-gray-400 text-2xl group-hover:translate-x-1 transition-transform z-10"><i class="fas fa-chevron-right"></i></div></div>
                </div>
            </div>

             <!-- === è§†å›¾: æ¸¸æˆ (å‡çº§ï¼šå¼‚ä¸–ç•Œ RPG) === -->
            <div v-else-if="currentView === 'game'" class="flex-1 flex flex-col overflow-hidden bg-gray-900 text-white relative">
                <!-- é¡¶éƒ¨å¯¼èˆª -->
                <div class="bg-gray-800 px-6 py-4 flex items-center gap-4 shadow-lg border-b border-gray-700 z-20">
                    <button @click="rpgQuit" class="w-10 h-10 rounded-full bg-gray-700 text-gray-300 flex items-center justify-center hover:bg-gray-600"><i class="fas fa-arrow-left"></i></button>
                    <div class="flex-1"><h2 class="text-lg font-bold text-purple-300">å¼‚ä¸–ç•Œå†’é™©</h2></div>
                    <div class="bg-gray-700 px-3 py-1 rounded-full text-xs font-bold text-yellow-400 border border-gray-600"><i class="fas fa-coins"></i> {{ userCoins }}</div>
                </div>

                <!-- åœºæ™¯ï¼šèœå• -->
                <div v-if="rpgGame.state === 'menu'" class="flex-1 flex flex-col items-center justify-center p-6 relative overflow-hidden">
                    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')] opacity-30 animate-pulse-custom"></div>
                    <div class="z-10 w-full max-w-md space-y-6">
                        <div @click="rpgGame.state = 'diff_select'" class="bg-gradient-to-br from-purple-600 to-indigo-800 rounded-[2rem] p-6 shadow-2xl border-4 border-purple-400 cursor-pointer hover:scale-105 transition-transform group relative overflow-hidden">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors"></div>
                            <div class="absolute -right-10 -bottom-10 text-9xl opacity-20 rotate-12">ğŸ°</div>
                            <h3 class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-200 to-pink-200 mb-2 filter drop-shadow-lg">è¨€éœŠã®è¿·å®®</h3>
                            <div class="text-sm font-bold text-purple-200 tracking-widest uppercase mb-4">Infinite Babel</div>
                            <div class="flex items-center gap-2 text-xs text-purple-100 bg-black/30 w-max px-3 py-1 rounded-full border border-white/10"><i class="fas fa-skull"></i> Roguelike çˆ¬å¡”</div>
                            <div class="mt-6 flex justify-end"><span class="bg-yellow-400 text-black text-xs font-bold px-4 py-2 rounded-full shadow-lg group-hover:animate-bounce">å¼€å§‹æŒ‘æˆ˜</span></div>
                        </div>
                         <!-- æ•¬è¯·æœŸå¾…çš„å…¶ä»–æ¸¸æˆ -->
                        <div class="opacity-50 grayscale hover:grayscale-0 transition-all duration-500 cursor-not-allowed bg-gray-800 rounded-[2rem] p-6 border-2 border-gray-700">
                             <h3 class="text-xl font-bold text-gray-400">é­”ç‹ã®åŸ (å¼€å‘ä¸­)</h3>
                             <p class="text-xs text-gray-500 mt-1">æ•¬è¯·æœŸå¾…æ›´å¤šç©æ³•...</p>
                        </div>
                    </div>
                </div>

                <!-- åœºæ™¯ï¼šéš¾åº¦é€‰æ‹© -->
                <div v-else-if="rpgGame.state === 'diff_select'" class="flex-1 flex flex-col p-6 z-10 bg-gray-900/95">
                    <h3 class="text-center text-xl font-bold text-purple-300 mb-8 animate-pulse">é€‰æ‹©è¯•ç‚¼éš¾åº¦</h3>
                    <div class="grid gap-4 max-w-md mx-auto w-full">
                        <button @click="startRpg('easy')" class="bg-gradient-to-r from-green-600 to-teal-700 p-5 rounded-2xl border-2 border-green-400 text-left hover:scale-105 transition-transform shadow-lg relative overflow-hidden">
                            <div class="absolute right-2 top-2 text-4xl opacity-20">ğŸƒ</div>
                            <div class="font-bold text-lg text-white">ç®€å• (Easy)</div>
                            <div class="text-xs text-green-100 mt-1">é€‚åˆ: N5 / N4</div>
                            <div class="mt-2 text-[10px] bg-black/20 inline-block px-2 py-1 rounded text-green-200">å¥–åŠ±: 5é‡‘å¸/é¢˜ | å¤±è´¥æƒ©ç½š: 20%</div>
                        </button>
                        <button @click="startRpg('normal')" class="bg-gradient-to-r from-blue-600 to-indigo-700 p-5 rounded-2xl border-2 border-blue-400 text-left hover:scale-105 transition-transform shadow-lg relative overflow-hidden">
                            <div class="absolute right-2 top-2 text-4xl opacity-20">âš”ï¸</div>
                            <div class="font-bold text-lg text-white">æ­£å¸¸ (Normal)</div>
                            <div class="text-xs text-blue-100 mt-1">é€‚åˆ: N3</div>
                            <div class="mt-2 text-[10px] bg-black/20 inline-block px-2 py-1 rounded text-blue-200">å¥–åŠ±: 10é‡‘å¸/é¢˜ | å¤±è´¥æƒ©ç½š: 40%</div>
                        </button>
                        <button @click="startRpg('hard')" class="bg-gradient-to-r from-red-600 to-rose-700 p-5 rounded-2xl border-2 border-red-400 text-left hover:scale-105 transition-transform shadow-lg relative overflow-hidden">
                             <div class="absolute right-2 top-2 text-4xl opacity-20">ğŸ”¥</div>
                            <div class="font-bold text-lg text-white">å›°éš¾ (Hard)</div>
                            <div class="text-xs text-red-100 mt-1">é€‚åˆ: N2 / N1</div>
                            <div class="mt-2 text-[10px] bg-black/20 inline-block px-2 py-1 rounded text-red-200">å¥–åŠ±: 20é‡‘å¸/é¢˜ | å¤±è´¥æƒ©ç½š: 60%</div>
                        </button>
                    </div>
                </div>

                <!-- åœºæ™¯ï¼šæ¸¸æˆè¿›è¡Œä¸­ -->
                <div v-else-if="rpgGame.state === 'playing'" class="flex-1 flex flex-col relative overflow-hidden" :class="{'animate-shake': rpgGame.shake}">
                    <!-- èƒŒæ™¯å±‚ -->
                    <div class="absolute inset-0 z-0 transition-colors duration-1000" :class="rpgGame.isBoss ? 'bg-red-900/30' : 'bg-gray-800/50'"></div>
                    
                    <!-- HUD -->
                    <div class="relative z-10 px-4 py-2 flex justify-between items-center bg-black/40 backdrop-blur-sm border-b border-white/10">
                        <div class="flex items-center gap-2"><span class="bg-purple-600 text-white text-xs font-bold px-2 py-0.5 rounded">B{{ rpgGame.floor }}F</span></div>
                        <div class="flex gap-1 text-red-500 text-lg drop-shadow-md">
                            <i v-for="n in 3" :key="n" class="fas fa-heart" :class="n <= rpgGame.hp ? 'animate-pulse' : 'text-gray-600'"></i>
                        </div>
                        <div class="flex items-center gap-2 font-mono font-bold text-yellow-400"><i class="fas fa-coins text-xs"></i> +{{ rpgGame.coinsEarned }}</div>
                    </div>

                    <!-- æ€ªç‰©ä¸å€’è®¡æ—¶ -->
                    <div class="relative z-10 flex-1 flex flex-col items-center justify-center p-4">
                        <!-- å€’è®¡æ—¶æ¡ -->
                        <div class="w-full max-w-xs h-2 bg-gray-700 rounded-full mb-6 overflow-hidden border border-gray-600">
                            <div class="h-full transition-all duration-1000 linear" 
                                :class="rpgGame.timer < 5 ? 'bg-red-500' : 'bg-green-500'" 
                                :style="{ width: (rpgGame.timer / (rpgGame.isBoss ? 10 : 15)) * 100 + '%' }">
                            </div>
                        </div>

                        <!-- æ€ªç‰©å½¢è±¡ -->
                        <div class="mb-6 relative">
                            <div class="text-8xl filter drop-shadow-[0_0_15px_rgba(255,255,255,0.5)] transition-all duration-500" :class="rpgGame.isBoss ? 'scale-125' : ''">
                                {{ rpgGame.isBoss ? 'ğŸ‰' : 'ğŸ‘»' }}
                            </div>
                            <div v-if="rpgGame.isBoss" class="absolute -top-4 left-1/2 -translate-x-1/2 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded border border-red-400 whitespace-nowrap animate-bounce">BOSS é™ä¸´</div>
                            <div v-if="rpgGame.damageText" class="absolute top-0 right-0 text-red-500 font-black text-2xl rpg-damage-text">{{ rpgGame.damageText }}</div>
                        </div>

                        <!-- é—®é¢˜æ¡† -->
                        <div class="w-full max-w-lg bg-black/60 backdrop-blur-md border-2 border-purple-400/50 rounded-2xl p-6 text-center shadow-2xl">
                             <h3 class="text-xl md:text-2xl font-bold text-white mb-2 leading-relaxed">{{ rpgGame.currentQ?.question }}</h3>
                             <p v-if="rpgGame.currentQ?.hint" class="text-xs text-gray-400">{{ rpgGame.currentQ.hint }}</p>
                        </div>
                    </div>

                    <!-- é€‰é¡¹åŒº -->
                    <div class="relative z-10 p-4 pb-8 grid grid-cols-1 md:grid-cols-2 gap-3 max-w-2xl mx-auto w-full">
                        <button v-for="(opt, idx) in rpgGame.currentQ?.options" :key="idx" 
                            @click="rpgAnswer(idx)"
                            class="bg-gray-800 hover:bg-gray-700 border-2 border-gray-600 text-gray-200 py-4 rounded-xl font-bold text-sm shadow-md active:scale-95 transition-all flex items-center justify-center relative overflow-hidden">
                            <span class="relative z-10">{{ opt }}</span>
                        </button>
                    </div>
                </div>

                <!-- åœºæ™¯ï¼šç»“ç®— -->
                <div v-else-if="rpgGame.state === 'result'" class="absolute inset-0 z-50 bg-black/90 flex flex-col items-center justify-center p-6 text-center animate-fade-in">
                    <div class="text-6xl mb-4">{{ rpgGame.hp > 0 ? 'ğŸ†' : 'ğŸ’€' }}</div>
                    <h2 class="text-3xl font-black text-white mb-2">{{ rpgGame.hp > 0 ? 'è®¨ä¼æˆåŠŸ' : 'ä½ è¢«æ‰“è´¥äº†' }}</h2>
                    <p class="text-gray-400 text-sm mb-6">æ­¢æ­¥äºç¬¬ {{ rpgGame.floor }} å±‚</p>
                    
                    <div class="bg-gray-800 rounded-2xl p-6 w-full max-w-xs border border-gray-700 mb-6 space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">æœ¬æ¬¡æ”¶ç›Š</span>
                            <span class="text-yellow-400 font-bold">+{{ rpgGame.coinsEarned }} é‡‘å¸</span>
                        </div>
                        <div v-if="rpgGame.penalty > 0" class="flex justify-between text-sm border-t border-gray-700 pt-2">
                            <span class="text-red-400">Bossæˆ˜è´¥æƒ©ç½š</span>
                            <span class="text-red-500 font-bold">-{{ rpgGame.penalty }} é‡‘å¸</span>
                        </div>
                         <div class="flex justify-between text-base border-t border-gray-700 pt-2 font-bold">
                            <span class="text-white">æœ€ç»ˆç»“ä½™</span>
                            <span :class="rpgGame.finalChange >= 0 ? 'text-green-400' : 'text-red-400'">{{ rpgGame.finalChange >= 0 ? '+' : '' }}{{ rpgGame.finalChange }}</span>
                        </div>
                    </div>

                    <button @click="rpgGame.state = 'menu'" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform hover:scale-105">è¿”å›å…¬ä¼š</button>
                </div>
            </div>

            <!-- === è§†å›¾: åŸºç¡€çŸ¥è¯† (ç»Ÿä¸€æ–°è§†å›¾) === -->
            <div v-else-if="currentView === 'basics'" class="flex-1 flex flex-col overflow-hidden skin-bg bg-opacity-10">
                <div class="skin-card-bg px-6 py-4 flex flex-col gap-3 shadow-sm border-b skin-border z-10">
                    <div class="flex items-center gap-4">
                        <button @click="currentView = 'home'" class="w-10 h-10 rounded-full skin-bg-light skin-text flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                        <div class="flex-1"><h2 class="text-lg font-bold">åŸºç¡€çŸ¥è¯†</h2></div>
                    </div>
                    <!-- å†…éƒ¨Tabåˆ‡æ¢ -->
                    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                        <button v-for="tab in ['kana', 'num', 'time']" :key="tab" @click="basicsTab = tab" 
                            :class="basicsTab === tab ? 'skin-bg text-white shadow-md' : 'bg-gray-100 text-gray-500 hover:bg-gray-200'"
                            class="flex-1 min-w-[70px] py-1.5 rounded-full text-xs font-bold transition-all">
                            {{ tab === 'kana' ? 'äº”åéŸ³' : (tab === 'num' ? 'æ•°å­—' : 'æ—¶é—´') }}
                        </button>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto p-6 pb-20 space-y-6">
                    
                    <!-- 1. äº”åéŸ³å›¾å†…å®¹ -->
                    <div v-if="basicsTab === 'kana'" class="bg-white rounded-[2rem] p-6 shadow-sm border-2 border-pink-200">
                        <div class="grid grid-cols-5 gap-2 text-center">
                            <div v-for="(row, rIdx) in kanaTable" :key="rIdx" class="contents">
                                <div v-for="(char, cIdx) in row.chars" :key="cIdx" @click="speak(char.k, 'ja-JP')" class="bg-gray-50 rounded-xl py-3 shadow-sm border border-gray-100 cursor-pointer active:scale-95 active:bg-pink-100 transition-all hover:border-pink-200">
                                    <div class="text-xl font-bold text-gray-800">{{ char.k }}</div>
                                    <div class="text-[10px] text-gray-400 font-mono">{{ char.r }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. æ•°å­—å†…å®¹ -->
                    <div v-if="basicsTab === 'num'" class="space-y-4">
                        <div class="bg-white rounded-[2rem] p-6 shadow-sm border-2 border-pink-200">
                            <h3 class="font-bold text-gray-600 mb-3 text-sm flex items-center gap-2"><i class="fas fa-hashtag text-pink-400"></i> åŸºç¡€æ•°å­— (1-20)</h3>
                            <div class="grid grid-cols-4 gap-2">
                                <div v-for="n in numberList.basic" :key="n.v" @click="speak(n.k, 'ja-JP')" class="bg-gray-50 rounded-lg py-2 text-center border border-gray-100 cursor-pointer active:bg-pink-100 hover:border-pink-200 transition-all">
                                    <div class="font-bold text-lg">{{ n.v }}</div><div class="text-xs text-gray-500">{{ n.k }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-[2rem] p-6 shadow-sm border-2 border-pink-200">
                            <h3 class="font-bold text-gray-600 mb-3 text-sm flex items-center gap-2"><i class="fas fa-layer-group text-purple-400"></i> æ•´å (30-90)</h3>
                            <div class="grid grid-cols-4 gap-2">
                                <div v-for="n in numberList.tens" :key="n.v" @click="speak(n.k, 'ja-JP')" class="bg-gray-50 rounded-lg py-2 text-center border border-gray-100 cursor-pointer active:bg-purple-100 hover:border-purple-200 transition-all">
                                    <div class="font-bold text-lg">{{ n.v }}</div><div class="text-xs text-gray-500">{{ n.k }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-[2rem] p-6 shadow-sm border-2 border-pink-200">
                            <h3 class="font-bold text-gray-600 mb-3 text-sm flex items-center gap-2"><i class="fas fa-globe text-blue-400"></i> å¤§æ•°å­—</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div v-for="n in numberList.big" :key="n.v" @click="speak(n.k, 'ja-JP')" class="bg-gray-50 rounded-lg py-2 text-center border border-gray-100 cursor-pointer active:bg-blue-100 hover:border-blue-200 transition-all">
                                    <div class="font-bold text-lg">{{ n.v }}</div><div class="text-xs text-gray-500">{{ n.k }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3. æ—¶é—´æ—¥æœŸå†…å®¹ -->
                    <div v-if="basicsTab === 'time'" class="space-y-4">
                         <!-- å°æ—¶ -->
                        <div class="bg-white rounded-[2rem] p-6 shadow-sm border-2 border-pink-200">
                            <h3 class="font-bold text-gray-600 mb-3 text-sm flex items-center gap-2"><i class="fas fa-clock text-blue-400"></i> å°æ—¶ (1-12ç‚¹)</h3>
                            <div class="grid grid-cols-4 gap-2">
                                <div v-for="t in timeData.hours" :key="t.v" @click="speak(t.k, 'ja-JP')" class="bg-blue-50 rounded-lg py-2 text-center border border-blue-100 cursor-pointer active:bg-blue-200 hover:shadow-md transition-all">
                                    <div class="font-bold">{{ t.v }}</div><div class="text-[10px] text-gray-500">{{ t.k }}</div>
                                </div>
                            </div>
                        </div>
                        <!-- åˆ†é’Ÿ -->
                        <div class="bg-white rounded-[2rem] p-6 shadow-sm border-2 border-pink-200">
                            <h3 class="font-bold text-gray-600 mb-3 text-sm flex items-center gap-2"><i class="fas fa-stopwatch text-green-400"></i> åˆ†é’Ÿ (1-60åˆ†)</h3>
                            <div class="grid grid-cols-5 gap-2 max-h-48 overflow-y-auto pr-1">
                                <div v-for="t in timeData.minutes" :key="t.v" @click="speak(t.k, 'ja-JP')" class="bg-green-50 rounded-lg py-2 text-center border border-green-100 cursor-pointer active:bg-green-200 hover:shadow-md transition-all">
                                    <div class="font-bold text-xs">{{ t.v }}</div><div class="text-[8px] text-gray-500 scale-90">{{ t.k }}</div>
                                </div>
                            </div>
                        </div>
                        <!-- æœˆä»½ -->
                        <div class="bg-white rounded-[2rem] p-6 shadow-sm border-2 border-pink-200">
                            <h3 class="font-bold text-gray-600 mb-3 text-sm flex items-center gap-2"><i class="fas fa-calendar-alt text-orange-400"></i> æœˆä»½ (1-12æœˆ)</h3>
                            <div class="grid grid-cols-4 gap-2">
                                <div v-for="t in timeData.months" :key="t.v" @click="speak(t.k, 'ja-JP')" class="bg-orange-50 rounded-lg py-2 text-center border border-orange-100 cursor-pointer active:bg-orange-200 hover:shadow-md transition-all">
                                    <div class="font-bold">{{ t.v }}</div><div class="text-[10px] text-gray-500">{{ t.k }}</div>
                                </div>
                            </div>
                        </div>
                         <!-- æ—¥æœŸ -->
                        <div class="bg-white rounded-[2rem] p-6 shadow-sm border-2 border-pink-200">
                            <h3 class="font-bold text-gray-600 mb-3 text-sm flex items-center gap-2"><i class="fas fa-sun text-red-400"></i> æ—¥æœŸ (1-31æ—¥)</h3>
                            <div class="grid grid-cols-5 gap-2">
                                <div v-for="t in timeData.days" :key="t.v" @click="speak(t.k, 'ja-JP')" class="bg-red-50 rounded-lg py-2 text-center border border-red-100 cursor-pointer active:bg-red-200 hover:shadow-md transition-all">
                                    <div class="font-bold text-sm">{{ t.v }}</div><div class="text-[8px] text-gray-500 scale-90">{{ t.k }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === è§†å›¾: çœŸé¢˜ (quiz) === -->
            <div v-else-if="currentView === 'quiz'" class="flex-1 flex flex-col overflow-hidden skin-bg bg-opacity-10">
                <div class="skin-card-bg px-6 py-4 flex flex-col gap-3 shadow-sm border-b skin-border z-10">
                    <div class="flex items-center gap-4">
                        <button @click="currentView = 'home'" class="w-10 h-10 rounded-full skin-bg-light skin-text flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                        <div class="flex-1"><h2 class="text-lg font-bold">çœŸé¢˜å®æˆ˜æ¼”ç»ƒ ({{ currentLevel }})</h2></div>
                         <button @click="resetQuiz" class="text-xs bg-gray-100 text-gray-500 hover:bg-gray-200 px-3 py-1.5 rounded-full font-bold flex items-center gap-1 transition-all"><i class="fas fa-redo-alt"></i> é‡ç½®æœ¬é¡µ</button>
                    </div>
                    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                        <button v-for="type in ['vocab', 'grammar', 'reading', 'listening']" :key="type" @click="quizType = type" 
                            :class="quizType === type ? 'skin-bg text-white shadow-md' : 'bg-gray-100 text-gray-500 hover:bg-gray-200'"
                            class="flex-1 min-w-[70px] py-1.5 rounded-full text-xs font-bold transition-all">
                            {{ type === 'vocab' ? 'è¯æ±‡' : (type === 'grammar' ? 'è¯­æ³•' : (type === 'reading' ? 'é˜…è¯»' : 'å¬åŠ›')) }}
                        </button>
                    </div>
                </div>
                <div class="px-4 pt-4 pb-2 flex gap-2 items-center justify-between">
                    <button v-if="lastQuizIndex >= 0" @click="resumeQuiz" class="bg-gradient-to-r from-yellow-400 to-orange-400 text-white text-xs px-4 py-2 rounded-full font-bold shadow-md hover:shadow-lg active:scale-95 transition-all flex items-center gap-1"><i class="fas fa-rocket"></i> ç»§ç»­åˆ·é¢˜ (#{{ lastQuizIndex + 1 }})</button>
                    <div class="flex-1"></div>
                    <div class="flex items-center gap-2 bg-white px-2 py-1.5 rounded-full shadow-sm border border-gray-200">
                        <span class="text-[10px] text-gray-400">è·³è½¬åˆ°</span>
                        <input type="number" v-model="quizJumpInput" @keyup.enter="manualQuizJump" class="w-10 text-center bg-gray-100 rounded text-xs py-0.5 outline-none font-bold" placeholder="#">
                        <button @click="manualQuizJump" class="text-xs text-indigo-500 font-bold">Go</button>
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto p-6 pb-20">
                    <div v-if="filteredQuiz.length === 0" class="text-center mt-20 text-gray-400"><p class="text-4xl mb-2">ğŸ“</p><p>æš‚æ— è¯¥ç±»å‹é¢˜ç›®</p></div>
                    <div v-else class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div v-for="(q, index) in filteredQuiz" :key="index" :id="'quiz-item-'+index" class="skin-card-bg p-6 rounded-[2rem] shadow-sm border-2 skin-border relative overflow-hidden transition-all duration-300" :class="index === lastQuizIndex ? 'ring-4 ring-yellow-200' : ''">
                            <span class="absolute top-0 left-0 bg-gray-100 text-gray-400 px-3 py-1 rounded-br-xl text-xs font-bold">Q{{ index + 1 }}</span>
                            <div v-if="index === lastQuizIndex" class="absolute top-0 right-0 bg-yellow-400 text-white text-[10px] px-2 py-1 rounded-bl-xl font-bold z-10 shadow-sm animate-pulse">ğŸ“ ä¸Šæ¬¡åšåˆ°è¿™</div>
                            <div v-if="rewardedQuizIds.includes(getQuizId(index))" class="absolute top-8 right-2 rotate-12 border-2 border-yellow-500 text-yellow-500 text-[10px] px-2 py-0.5 rounded font-bold opacity-70">ğŸ’° å·²é¢†èµ</div>
                            <div v-if="quizType === 'reading' && q.article" class="mt-6 mb-4 bg-gray-50 p-4 rounded-xl text-sm leading-relaxed font-serif border border-gray-100 text-gray-700">
                                <span class="bg-gray-200 text-gray-500 text-[10px] px-2 py-0.5 rounded mb-2 inline-block">é˜…è¯»æ–‡ç« </span>
                                <div class="whitespace-pre-line">{{ q.article }}</div>
                            </div>
                            <div v-if="quizType === 'listening'" class="mt-6 mb-4">
                                <div class="bg-indigo-50 p-3 rounded-xl flex items-center justify-between border border-indigo-100 mb-2">
                                    <div class="flex items-center gap-2">
                                        <button @click="playQuizAudio(q)" :class="q.isPlaying ? 'bg-red-500' : 'bg-indigo-500'" class="w-8 h-8 rounded-full flex items-center justify-center text-white cursor-pointer hover:opacity-80 transition-all">
                                            <i class="fas" :class="q.isPlaying ? 'fa-stop' : 'fa-play'"></i>
                                        </button>
                                        <div class="flex flex-col">
                                            <span class="text-xs text-indigo-700 font-bold">Audio Track {{ index + 1 }}</span>
                                            <div v-if="q.isPlaying" class="playing-wave"><span></span><span></span><span></span></div>
                                        </div>
                                    </div>
                                    <span class="text-[10px] text-gray-400">{{ q.isPlaying ? 'æ’­æ”¾ä¸­...' : 'ç‚¹å‡»æ’­æ”¾' }}</span>
                                </div>
                                <button @click="q.showScript = !q.showScript" class="text-xs text-gray-400 underline hover:text-indigo-500">
                                    {{ q.showScript ? 'æ”¶èµ·åŸæ–‡' : 'æŸ¥çœ‹å¬åŠ›åŸæ–‡' }}
                                </button>
                                <div v-if="q.showScript" class="mt-2 text-xs text-gray-600 bg-gray-50 p-3 rounded-lg border border-dashed border-gray-200 whitespace-pre-line">
                                    {{ q.audioScript || 'æš‚æ— åŸæ–‡æ•°æ®' }}
                                </div>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mt-2 mb-6 leading-relaxed" :class="{'mt-4': quizType !== 'reading' && quizType !== 'listening'}">{{ q.question }}</h3>
                            <div class="space-y-3">
                                <button v-for="(opt, optIdx) in q.options" :key="optIdx" @click="checkAnswer(q, optIdx)" :class="{'bg-gray-50 text-gray-600 hover:bg-gray-100': q.userAnswer === undefined, 'bg-green-100 text-green-700 border-green-200': q.userAnswer !== undefined && optIdx === q.answer, 'bg-red-100 text-red-700 border-red-200': q.userAnswer === optIdx && optIdx !== q.answer, 'opacity-50': q.userAnswer !== undefined && optIdx !== q.answer && optIdx !== q.userAnswer}" class="w-full text-left px-5 py-3 rounded-xl border border-transparent transition-all font-medium text-sm flex justify-between items-center">
                                    <span>{{ ['A', 'B', 'C', 'D'][optIdx] }}. {{ opt }}</span>
                                    <i v-if="q.userAnswer !== undefined && optIdx === q.answer" class="fas fa-check-circle text-green-500"></i>
                                    <i v-if="q.userAnswer === optIdx && optIdx !== q.answer" class="fas fa-times-circle text-red-500"></i>
                                </button>
                            </div>
                            <div v-if="q.userAnswer !== undefined" class="mt-4 p-4 bg-indigo-50 rounded-xl text-xs text-indigo-800 leading-relaxed"><span class="font-bold block mb-1">ğŸ’¡ è§£æï¼š</span>{{ q.explain }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === è§†å›¾: å•†åº— === -->
             <div v-else-if="currentView === 'shop'" class="flex-1 flex flex-col skin-bg bg-opacity-20 overflow-hidden">
                <div class="skin-card-bg px-6 py-4 flex items-center gap-2 shadow-sm border-b skin-border z-10">
                    <button @click="currentView = 'home'" class="w-8 h-8 rounded-full skin-bg-light skin-text flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                    <div class="flex-1"><h2 class="text-lg font-bold">å•†åº—</h2><p class="text-xs opacity-60">è§£é”æ›´å¤šç²¾å½©</p></div>
                    <button @click="openRedeem" class="bg-indigo-100 text-indigo-600 px-3 py-1.5 rounded-full text-xs font-bold shadow-sm flex items-center gap-1"><i class="fas fa-key"></i> å…‘æ¢ç </button>
                    <button @click="showRechargeModal = true" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-3 py-1.5 rounded-full text-xs font-bold shadow-md animate-pulse"><i class="fas fa-plus-circle"></i> å……å€¼</button>
                </div>
                <div class="p-4 pb-0">
                    <div class="bg-white rounded-[1.5rem] p-5 shadow-lg border-2 border-pink-100 relative overflow-hidden">
                        <div class="flex justify-between items-start mb-4 relative z-10">
                            <div><h3 class="font-bold text-gray-800 text-lg flex items-center gap-2">ğŸŒ¸ æ¨±èŠ±æˆé•¿ä¹‹è·¯</h3><p class="text-[10px] text-gray-400 mt-1">æ¯æ—¥å­¦ä¹ 30åˆ†é’Ÿè·å¾—1æœµï¼Œ<span class="text-pink-500 font-bold">å…‘æ¢ä¸æ‰£é™¤æ¨±èŠ±</span></p></div>
                            <div class="text-right"><div class="text-2xl font-bold text-pink-500">{{ userSakuras }} <span class="text-sm text-gray-400">æœµ</span></div></div>
                        </div>
                        <div class="relative w-full h-3 bg-gray-100 rounded-full mb-8 mt-6">
                            <div class="absolute left-0 top-0 h-full bg-gradient-to-r from-pink-300 to-rose-400 rounded-full transition-all duration-1000" :style="{ width: Math.min((userSakuras / 500) * 100, 100) + '%' }"></div>
                            <div class="absolute top-1/2 -translate-y-1/2" style="left: 10%"><div class="flex flex-col items-center group cursor-pointer" @click="claimMilestone(milestones[0])"><div class="w-6 h-6 rounded-full border-2 flex items-center justify-center shadow-sm z-10 transition-all" :class="milestonesClaimed.includes(50) ? 'bg-gray-200 border-gray-300' : (userSakuras >= 50 ? 'bg-yellow-400 border-yellow-200 animate-bounce' : 'bg-white border-gray-200')"><i v-if="milestonesClaimed.includes(50)" class="fas fa-check text-[10px] text-gray-500"></i><i v-else class="fas fa-gift text-[10px]" :class="userSakuras >= 50 ? 'text-white' : 'text-gray-300'"></i></div><div class="absolute top-7 w-20 text-center"><div class="text-[10px] font-bold text-gray-600">50æœµ</div><div class="text-[10px] text-yellow-500 font-bold scale-90">2000é‡‘å¸</div></div></div></div>
                            <div class="absolute top-1/2 -translate-y-1/2" style="left: 20%"><div class="flex flex-col items-center group cursor-pointer" @click="claimMilestone(milestones[1])"><div class="w-6 h-6 rounded-full border-2 flex items-center justify-center shadow-sm z-10 transition-all" :class="milestonesClaimed.includes(100) ? 'bg-gray-200 border-gray-300' : (userSakuras >= 100 ? 'bg-pink-500 border-pink-300 animate-bounce' : 'bg-white border-gray-200')"><i v-if="milestonesClaimed.includes(100)" class="fas fa-check text-[10px] text-gray-500"></i><i v-else class="fas fa-user-nurse text-[10px]" :class="userSakuras >= 100 ? 'text-white' : 'text-gray-300'"></i></div><div class="absolute top-7 w-20 text-center"><div class="text-[10px] font-bold text-gray-600">100æœµ</div><div class="text-[10px] text-pink-500 font-bold scale-90">å¥³æŠ¤å£«AI</div></div></div></div>
                            <div class="absolute top-1/2 -translate-y-1/2" style="left: 60%"><div class="flex flex-col items-center group cursor-pointer" @click="claimMilestone(milestones[2])"><div class="w-6 h-6 rounded-full border-2 flex items-center justify-center shadow-sm z-10 transition-all" :class="milestonesClaimed.includes(300) ? 'bg-gray-200 border-gray-300' : (userSakuras >= 300 ? 'bg-yellow-400 border-yellow-200 animate-bounce' : 'bg-white border-gray-200')"><i v-if="milestonesClaimed.includes(300)" class="fas fa-check text-[10px] text-gray-500"></i><i v-else class="fas fa-crown text-[10px]" :class="userSakuras >= 300 ? 'text-white' : 'text-gray-300'"></i></div><div class="absolute top-7 w-24 text-center"><div class="text-[10px] font-bold text-gray-600">300æœµ</div><div class="text-[10px] text-yellow-500 font-bold scale-90">1Wé‡‘å¸</div></div></div></div>
                            <div class="absolute top-1/2 -translate-y-1/2 right-0"><div class="flex flex-col items-center group cursor-pointer" @click="claimMilestone(milestones[3])"><div class="w-8 h-8 rounded-full border-2 flex items-center justify-center shadow-lg z-10 transition-all" :class="milestonesClaimed.includes(500) ? 'bg-gray-200 border-gray-300' : (userSakuras >= 500 ? 'bg-gradient-to-r from-purple-500 to-indigo-500 border-white animate-pulse' : 'bg-white border-gray-200')"><i v-if="milestonesClaimed.includes(500)" class="fas fa-check text-xs text-gray-500"></i><i v-else class="fas fa-gem text-xs" :class="userSakuras >= 500 ? 'text-white' : 'text-gray-300'"></i></div><div class="absolute top-9 right-0 w-24 text-right"><div class="text-[10px] font-bold text-gray-600">500æœµ</div><div class="text-[10px] text-purple-600 font-bold scale-90">ç»ˆèº«VIP</div></div></div></div>
                        </div>
                    </div>
                </div>
                <div class="flex p-4 pb-0 gap-4">
                    <button @click="shopTab = 'items'" :class="shopTab === 'items' ? 'bg-gradient-to-r from-pink-400 to-rose-400 text-white shadow-md' : 'bg-white text-gray-500'" class="flex-1 py-2 rounded-xl font-bold transition-all text-sm">ğŸ›ï¸ ç™¾è´§</button>
                    <button @click="shopTab = 'themes'" :class="shopTab === 'themes' ? 'skin-bg text-white shadow-md' : 'bg-white text-gray-500'" class="flex-1 py-2 rounded-xl font-bold transition-all text-sm">ğŸ¨ çš®è‚¤</button>
                    <button @click="shopTab = 'chars'" :class="shopTab === 'chars' ? 'bg-indigo-500 text-white shadow-md' : 'bg-white text-gray-500'" class="flex-1 py-2 rounded-xl font-bold transition-all text-sm">ğŸ¤– AIåŠ©æ•™</button>
                </div>
                <div v-if="shopTab === 'items'" class="flex-1 overflow-y-auto p-4 pb-20">
                     <div class="bg-indigo-50 rounded-xl p-3 mb-4 text-xs text-indigo-700 flex items-center gap-2 border border-indigo-100"><i class="fas fa-info-circle text-lg"></i><span>è´­ä¹°åå°†ç›´æ¥é€ç»™å½“å‰æ´»è·ƒçš„AI ({{ activeCharacter.name }})ã€‚<br>é£Ÿç‰©æ¢å¤ç²¾åŠ›ï¼Œç¤¼ç‰©/æœé¥°å¢åŠ å¥½æ„Ÿå¹¶è§¦å‘ç‰¹æ®Šå‰§æƒ…ï¼</span></div>
                    <h3 class="font-bold text-gray-600 mb-2 pl-1">ğŸ± èƒ½é‡è¡¥ç»™ (æ¢å¤ç²¾åŠ›)</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div v-for="item in shopItems.filter(i => i.type === 'food')" :key="item.id" class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 flex flex-col items-center hover:shadow-md transition-all">
                            <div class="text-4xl mb-2">{{ item.icon }}</div><h4 class="font-bold text-gray-800 text-sm">{{ item.name }}</h4><p class="text-[10px] text-green-500 mb-2 font-bold">+{{ item.restore }} ç²¾åŠ›</p><button @click="buyItem(item)" class="w-full bg-yellow-400 text-white text-xs py-1.5 rounded-full font-bold shadow-sm active:scale-95">ğŸ’° {{ item.price }}</button>
                        </div>
                    </div>
                    <h3 class="font-bold text-gray-600 mb-2 pl-1">ğŸ çè´µç¤¼ç‰© (æå‡å¥½æ„Ÿ)</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div v-for="item in shopItems.filter(i => i.type === 'gift')" :key="item.id" class="bg-white rounded-2xl p-4 shadow-sm border border-pink-50 flex flex-col items-center hover:shadow-md transition-all relative overflow-hidden group">
                            <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">{{ item.icon }}</div><h4 class="font-bold text-gray-800 text-sm">{{ item.name }}</h4>
                            <div class="mb-2 text-center"><span v-if="isVIP && item.vipPrice" class="text-red-500 font-bold text-xs mr-1">Â¥{{ item.vipPrice }}</span><span :class="{'line-through text-gray-300 text-[10px]': isVIP && item.vipPrice, 'text-gray-500 text-xs font-bold': !(isVIP && item.vipPrice)}">ğŸ’°{{ item.price }}</span><span v-if="isVIP && item.vipPrice" class="text-[8px] bg-red-100 text-red-500 px-1 rounded ml-1">VIP</span></div><button @click="buyItem(item)" class="w-full bg-pink-400 text-white text-xs py-1.5 rounded-full font-bold shadow-sm active:scale-95">èµ é€</button>
                        </div>
                    </div>
                    <h3 class="font-bold text-gray-600 mb-2 pl-1">ğŸ‘— è§’è‰²æœé¥° (AIè£…æ‰®)</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div v-for="item in shopItems.filter(i => i.type === 'cloth')" :key="item.id" class="bg-white rounded-2xl p-4 shadow-sm border border-purple-50 flex flex-col items-center hover:shadow-md transition-all">
                            <div class="text-4xl mb-2">{{ item.icon }}</div><h4 class="font-bold text-gray-800 text-sm">{{ item.name }}</h4><div class="text-[10px] text-gray-400 mb-1 scale-90">{{ item.desc }}</div>
                            <div class="mb-2 text-center"><span v-if="isVIP && item.vipPrice" class="text-red-500 font-bold text-xs mr-1">Â¥{{ item.vipPrice }}</span><span :class="{'line-through text-gray-300 text-[10px]': isVIP && item.vipPrice, 'text-gray-500 text-xs font-bold': !(isVIP && item.vipPrice)}">ğŸ’°{{ item.price }}</span></div><button @click="buyItem(item)" class="w-full bg-purple-400 text-white text-xs py-1.5 rounded-full font-bold shadow-sm active:scale-95">è´­ä¹°</button>
                        </div>
                    </div>
                </div>
                <div v-if="shopTab === 'themes'" class="flex-1 overflow-y-auto p-4 pb-20 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <div v-for="theme in themes" :key="theme.id" class="skin-card-bg rounded-2xl p-3 shadow-sm border-2 flex flex-col items-center relative transition-all hover:scale-105" :class="activeThemeId === theme.id ? 'border-yellow-400 ring-2 ring-yellow-200' : 'border-gray-100/50'">
                        <div v-if="activeThemeId === theme.id" class="absolute top-2 right-2 bg-yellow-400 text-white text-[10px] px-2 py-0.5 rounded-full font-bold z-10 shadow-sm">ä½¿ç”¨ä¸­</div>
                        <div class="w-full h-20 rounded-xl mb-3 flex items-center justify-center text-4xl shadow-inner relative overflow-hidden" :style="{ backgroundColor: theme.colors.bg }"><div class="absolute inset-0 opacity-30" :style="{ backgroundImage: theme.colors.pattern }"></div><span class="relative z-10 drop-shadow-md">{{ theme.icon }}</span></div>
                        <h3 class="font-bold text-sm mb-1 opacity-80">{{ theme.name }}</h3>
                        <div v-if="ownedThemes.includes(theme.id)" class="w-full"><button v-if="activeThemeId !== theme.id" @click="equipTheme(theme.id)" class="w-full bg-gray-100 text-gray-500 hover:bg-gray-200 text-xs py-1.5 rounded-full font-bold">è£…å¤‡</button><button v-else class="w-full bg-yellow-100 text-yellow-600 text-xs py-1.5 rounded-full font-bold cursor-default">å·²è£…å¤‡</button></div>
                        <div v-else class="w-full"><button @click="buyTheme(theme)" class="w-full bg-yellow-400 text-white hover:bg-yellow-500 text-xs py-1.5 rounded-full font-bold shadow-sm flex items-center justify-center gap-1"><i class="fas fa-coins text-[10px]"></i> {{ theme.price }}</button></div>
                    </div>
                </div>
                <div v-if="shopTab === 'chars'" class="flex-1 overflow-y-auto p-4 pb-20 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                     <div v-for="char in characters" :key="char.id" class="bg-white rounded-2xl p-3 shadow-sm border-2 flex flex-col items-center relative transition-all border-indigo-50 hover:scale-105">
                        <div class="text-4xl mb-2">{{ char.icon }}</div><h3 class="font-bold text-sm mb-1 text-gray-800">{{ char.name }}</h3><p class="text-[10px] text-gray-400 mb-3 text-center line-clamp-1">{{ char.desc }}</p>
                        <div class="w-full mt-auto"><button v-if="isVIP || unlockedChars.includes(char.id) || !char.isLocked" @click="selectCharacter(char); enterModule('chat')" class="w-full bg-indigo-100 text-indigo-600 text-xs py-1.5 rounded-full font-bold">{{ !char.isLocked || isVIP || unlockedChars.includes(char.id) ? 'å·²æ‹¥æœ‰' : 'å»èŠå¤©' }}</button><button v-else @click="handleRecharge(0, 9.9, 'char', char)" class="w-full bg-indigo-500 text-white hover:bg-indigo-600 text-xs py-1.5 rounded-full font-bold shadow-sm">Â¥9.9 è§£é”</button></div>
                     </div>
                </div>
            </div>

             <div v-else-if="currentView === 'chat'" class="flex-1 flex flex-col overflow-hidden bg-gray-50/50 w-full max-w-3xl mx-auto border-x border-gray-100/50">
                <div class="skin-card-bg px-4 py-3 shadow-sm border-b skin-border z-10 relative">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2"><button @click="currentView = 'home'" class="w-8 h-8 rounded-full skin-bg-light skin-text flex items-center justify-center"><i class="fas fa-arrow-left"></i></button><div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center text-xl border border-indigo-200">{{ activeCharacter.icon }}</div><div><div class="font-bold text-sm text-gray-800 flex items-center gap-1">{{ activeCharacter.name }} <span v-if="isCharLocked(activeCharacter)" class="text-[10px] bg-gray-200 text-gray-500 px-1 rounded"><i class="fas fa-lock"></i></span></div><div class="text-[10px] text-gray-400">{{ activeCharacter.desc }}</div></div></div>
                        <button @click="showCharSelect = true" class="bg-indigo-500 hover:bg-indigo-600 text-white text-xs px-3 py-1.5 rounded-full font-bold shadow-md flex items-center gap-1 transition-all active:scale-95 animate-pulse"><i class="fas fa-sync-alt"></i> åˆ‡æ¢ç§æ•™</button>
                    </div>
                    
                    <!-- â¤ï¸ æ‹çˆ±è¿›åº¦æ¡ UI -->
                    <div class="flex items-center gap-2">
                        <div class="text-[10px] text-pink-500 font-bold whitespace-nowrap">â¤ï¸ {{ levelLabel }} (Lv.{{ activeCharStats.level }})</div>
                        <div class="flex-1 h-3 bg-gray-100 rounded-full overflow-hidden border border-pink-100 relative">
                            <div class="absolute left-0 top-0 h-full bg-gradient-to-r from-pink-300 to-rose-400 rounded-full transition-all duration-700" :style="{ width: progressPercent + '%' }"></div>
                            <div class="absolute inset-0 flex items-center justify-center text-[8px] text-white font-bold drop-shadow-md">{{ activeCharStats.affinity }} / {{ nextLevelThreshold }}</div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-indigo-50 px-4 py-1 flex justify-between items-center border-b border-indigo-100"><div class="flex items-center gap-2 text-[10px] text-indigo-400"><span>âš¡ ç²¾åŠ›å€¼:</span><div class="w-16 h-2 bg-gray-200 rounded-full overflow-hidden"><div class="h-full rounded-full transition-all duration-500" :class="aiEnergy > 30 ? 'bg-green-400' : 'bg-red-400'" :style="{ width: aiEnergy + '%' }"></div></div></div><div @click="goToShopForItems" class="text-[10px] text-indigo-500 underline cursor-pointer font-bold">å»å•†åº—ä¹°åƒçš„ ></div></div>
                <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chat-container">
                    <div class="flex justify-center my-4"><span class="text-xs text-gray-400 bg-gray-200 px-3 py-1 rounded-full">AI å¯¹è¯å·²å¼€å§‹</span></div>
                    <!-- ğŸŸ¢ æ ¸å¿ƒä¿®æ”¹ï¼šTTSåªè¯»æ—¥è¯­æ–‡æœ¬ï¼Œè¿‡æ»¤ç¿»è¯‘å’ŒåŠ¨ä½œ -->
                    <div v-for="(msg, index) in chatMessages" :key="index" class="flex w-full" :class="msg.role === 'user' ? 'justify-end' : 'justify-start'"><div v-if="msg.role === 'assistant'" class="w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center mr-2 text-lg shadow-sm shrink-0">{{ activeCharacter.icon }}</div><div class="max-w-[80%] px-4 py-2.5 text-sm shadow-sm leading-relaxed relative group" :class="msg.role === 'user' ? 'msg-user' : 'msg-ai'"><div v-html="renderMarkdown(msg.content)"></div><div v-if="msg.role === 'assistant'" class="absolute -right-16 top-0 opacity-0 group-hover:opacity-100 transition-opacity flex gap-2"><button @click="speak(cleanTextForTTS(msg.content), 'ja-JP', activeCharacter)" class="w-6 h-6 rounded-full bg-white shadow text-gray-400 hover:text-indigo-500 flex items-center justify-center"><i class="fas fa-volume-up text-xs"></i></button></div></div></div>
                    <div v-if="isTyping" class="flex justify-start w-full"><div class="w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center mr-2 shrink-0">{{ activeCharacter.icon }}</div><div class="msg-ai px-4 py-3 flex items-center gap-1"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div>
                </div>
                <div ref="quickBar" @mousedown="startDrag" @mouseleave="stopDrag" @mouseup="stopDrag" @mousemove="onDrag" class="bg-gray-50 border-t border-gray-200 pt-2 pb-1 overflow-x-auto no-scrollbar flex gap-2 px-3 cursor-grab active:cursor-grabbing select-none"><button v-for="(phrase, idx) in quickPhrases" :key="idx" @click="sendQuickMessage(phrase)" class="whitespace-nowrap px-3 py-1.5 rounded-full bg-white border border-gray-200 text-xs text-gray-600 shadow-sm hover:bg-pink-50 hover:border-pink-200 hover:text-pink-500 transition-all flex flex-col items-start shrink-0 pointer-events-auto"><span class="font-bold">{{ phrase.ja }}</span><span class="text-[10px] opacity-60 scale-90 origin-left">{{ phrase.cn }}</span></button></div>
                <div class="bg-gray-100 border-t border-gray-200 px-4 py-1 flex justify-between items-center text-[10px]"><div class="flex items-center gap-2"><span v-if="isVIP" class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-500 to-red-500 font-bold">ğŸ‘‘ å°Šè´µVIPç”¨æˆ· (ç•…èŠæ¨¡å¼)</span><span v-else-if="dailyAiCount < 3" class="text-green-600 font-bold">ğŸ’š ä»Šæ—¥å…è´¹: {{ 3 - dailyAiCount }}/3 å¥</span><span v-else class="text-orange-500 font-bold">ğŸ’° æœ¬æ¬¡æ¶ˆè€—: {{ activeCharacter.cost }} é‡‘å¸ (ä½™é¢: {{userCoins}})</span></div><button v-if="!isVIP" @click="handleRecharge(9999999, 39.9, 'max')" class="text-indigo-500 underline font-bold animate-pulse">åˆ«å•ä¹°äº†ï¼ŒÂ¥39.9 æŠŠæ•´ä¸ªç½‘ç«™å¸¦å›å®¶å§ â¤ï¸</button></div>
                <div class="bg-white p-3 border-t border-gray-100 flex items-end gap-2"><textarea v-model="inputMessage" @keyup.enter.prevent="sendMessage(null)" placeholder="è¾“å…¥æ—¥è¯­æˆ–ä¸­æ–‡... è¯•ç€è¾“å…¥'é€ä½ é²œèŠ±'" class="flex-1 bg-gray-50 rounded-2xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-100 resize-none max-h-24" rows="1"></textarea><button @click="sendMessage(null)" :disabled="isTyping || !inputMessage.trim()" class="w-10 h-10 rounded-full bg-indigo-500 text-white flex items-center justify-center shadow-lg hover:bg-indigo-600 disabled:opacity-50 transition-all mb-0.5"><i class="fas fa-paper-plane"></i></button></div>
                <div v-if="showCharSelect" class="absolute inset-0 z-40 flex flex-col justify-end"><div @click="showCharSelect = false" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div><div class="bg-white rounded-t-[2rem] p-6 z-50 h-[70%] flex flex-col animate-slide-up"><div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg">é€‰æ‹©ç§æ•™</h3><button @click="showCharSelect = false" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center"><i class="fas fa-times"></i></button></div><div class="flex-1 overflow-y-auto grid grid-cols-2 gap-3 pb-4"><div v-for="char in characters" :key="char.id" @click="selectCharacter(char)" class="border-2 rounded-xl p-3 flex flex-col items-center gap-2 cursor-pointer relative overflow-hidden transition-all hover:scale-[1.02]" :class="activeCharacter.id === char.id ? 'border-indigo-500 bg-indigo-50' : 'border-gray-100 bg-white'"><div v-if="isCharLocked(char)" class="absolute inset-0 bg-black/40 flex flex-col items-center justify-center text-white z-10 backdrop-blur-[1px]"><i class="fas fa-lock text-2xl mb-1"></i><span class="text-[10px] font-bold">VIP</span></div><div class="text-4xl">{{ char.icon }}</div><div class="text-center"><div class="font-bold text-sm text-gray-800">{{ char.name }}</div><div class="text-[10px] text-gray-400">æ¶ˆè€—: {{ isVIP ? 0 : (dailyAiCount < 3 ? 'å…è´¹' : char.cost + 'é‡‘å¸') }}</div></div></div></div></div></div>
             </div>

             <!-- === è§†å›¾: é”™é¢˜å›é¡¾ === -->
             <div v-else-if="currentView === 'review'" class="flex-1 flex flex-col overflow-hidden skin-bg bg-opacity-10">
                <div class="skin-card-bg px-6 py-4 flex items-center gap-4 shadow-sm border-b skin-border z-10">
                    <button @click="currentView = 'home'" class="w-10 h-10 rounded-full skin-bg-light skin-text flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                    <div class="flex-1"><h2 class="text-lg font-bold">é”™é¢˜å›é¡¾</h2></div>
                </div>
                <div class="flex-1 overflow-y-auto p-6 pb-20">
                    <div v-if="mistakes.length === 0" class="flex flex-col items-center justify-center h-full text-center p-6"><div class="text-6xl mb-4">ğŸ†</div><h3 class="text-xl font-bold text-gray-800 mb-2">å“‡ï¼ä½ æ˜¯å¤©æ‰å—ï¼Ÿ</h3><p class="text-gray-500 text-sm max-w-xs leading-relaxed">ç›®å‰æ²¡æœ‰é”™é¢˜å“¦ï¼<br>ç»§ç»­ä¿æŒï¼ğŸ‘</p></div>
                    <div v-else>
                         <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-4 mb-6 text-center"><p class="text-indigo-700 font-bold text-sm mb-2">å‘ç° {{ mistakes.length }} é“é”™é¢˜</p><p class="text-xs text-gray-500 mb-3">è¿™äº›é¢˜ç›®å·²è¢«æ°¸ä¹…è®°å½•ï¼Œç›´åˆ°ä½ å­¦ä¼šä¸ºæ­¢ï¼</p></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- é”™é¢˜å¡ç‰‡ -->
                            <div v-for="(q, index) in mistakes" :key="index" class="skin-card-bg p-6 rounded-[2rem] shadow-sm border-2 border-red-100 relative overflow-hidden group">
                                <span class="absolute top-0 left-0 bg-red-100 text-red-500 px-3 py-1 rounded-br-xl text-xs font-bold">{{ q.type === 'vocab' ? 'è¯æ±‡' : 'è¯­æ³•' }} | {{ q.level }}</span>
                                <h3 class="text-lg font-bold text-gray-800 mt-4 mb-6 leading-relaxed">{{ q.question }}</h3>
                                <div class="space-y-3">
                                    <button v-for="(opt, optIdx) in q.options" :key="optIdx" @click="if(q.userAnswer===undefined){ q.userAnswer=optIdx; if(optIdx===q.answer){alert('ç­”å¯¹äº†ï¼âœ¨');} else {alert('è¿˜æ˜¯é”™çš„å“¦...å†çœ‹çœ‹è§£æå§ ğŸ˜‚');} }" 
                                        :class="{
                                            'bg-gray-50 text-gray-600 hover:bg-gray-100': q.userAnswer === undefined, 
                                            'bg-green-100 text-green-700 border-green-200': q.userAnswer !== undefined && optIdx === q.answer, 
                                            'bg-red-100 text-red-700 border-red-200': q.userAnswer === optIdx && optIdx !== q.answer, 
                                            'opacity-50': q.userAnswer !== undefined && optIdx !== q.answer && optIdx !== q.userAnswer
                                        }" 
                                        class="w-full text-left px-5 py-3 rounded-xl border border-transparent transition-all font-medium text-sm flex justify-between items-center">
                                        <span>{{ ['A', 'B', 'C', 'D'][optIdx] }}. {{ opt }}</span>
                                        <i v-if="q.userAnswer !== undefined && optIdx === q.answer" class="fas fa-check-circle text-green-500"></i>
                                        <i v-if="q.userAnswer === optIdx && optIdx !== q.answer" class="fas fa-times-circle text-red-500"></i>
                                    </button>
                                </div>
                                <div v-if="q.userAnswer !== undefined" class="mt-4 p-4 bg-gray-50 rounded-xl text-xs text-gray-600 leading-relaxed"><span class="font-bold block mb-1">ğŸ’¡ è§£æï¼š</span>{{ q.explain }}</div>
                                <div class="mt-4 flex gap-2">
                                    <button @click="q.userAnswer = undefined" class="flex-1 bg-gray-100 text-gray-600 py-2 rounded-xl text-xs font-bold hover:bg-gray-200"><i class="fas fa-redo"></i> é‡åš</button>
                                    <button @click="removeMistake(index)" class="flex-1 bg-green-100 text-green-600 py-2 rounded-xl text-xs font-bold hover:bg-green-200"><i class="fas fa-check"></i> æˆ‘å­¦ä¼šäº†</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === è§†å›¾: åˆ—è¡¨ (è¯æ±‡/è¯­æ³•) === -->
            <div v-else class="flex-1 flex flex-col overflow-hidden skin-bg bg-opacity-10">
                <div class="skin-card-bg px-6 py-4 flex items-center gap-4 shadow-sm border-b skin-border z-10">
                    <button @click="currentView = 'home'" class="w-10 h-10 rounded-full skin-bg-light skin-text flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                    <div class="flex-1"><h2 class="text-lg font-bold">{{ moduleTitle }}</h2></div>
                    <div class="relative w-32 focus-within:w-40 transition-all"><input v-model="searchQuery" type="text" placeholder="æœç´¢..." class="w-full bg-gray-100/50 rounded-full py-1.5 pl-8 pr-3 text-sm focus:outline-none focus:bg-white focus:ring-2 skin-border"><i class="fas fa-search absolute left-2.5 top-2 text-gray-400 text-xs"></i></div>
                </div>
                
                <div class="px-4 pt-4 pb-2 flex gap-2 items-center justify-between">
                    <button v-if="lastLearnedIndex >= 0" @click="resumeLearn" class="bg-gradient-to-r from-yellow-400 to-orange-400 text-white text-xs px-4 py-2 rounded-full font-bold shadow-md hover:shadow-lg active:scale-95 transition-all flex items-center gap-1"><i class="fas fa-rocket"></i> ç»§ç»­å­¦ä¹  (#{{ lastLearnedIndex + 1 }})</button>
                    <div class="flex-1"></div>
                    <div class="flex items-center gap-2 bg-white px-2 py-1.5 rounded-full shadow-sm border border-gray-200">
                        <span class="text-[10px] text-gray-400">è·³è½¬åˆ°</span>
                        <input type="number" v-model="jumpInput" @keyup.enter="manualJump" class="w-10 text-center bg-gray-100 rounded text-xs py-0.5 outline-none font-bold" placeholder="#">
                        <button @click="manualJump" class="text-xs text-indigo-500 font-bold">Go</button>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto p-4 pb-20" id="learn-list-container">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        <div v-for="(item, index) in filteredList" :key="index" :id="'learn-item-'+index" @click="saveLearnProgress(index)" 
                            class="bg-white p-5 rounded-[1.5rem] shadow-sm border transition-all group relative cursor-pointer"
                            :class="[
                                index === lastLearnedIndex ? 'border-2 border-yellow-400 ring-2 ring-yellow-100' : (item.isSelected ? 'border-2 border-yellow-400 shadow-md ring-1 ring-yellow-50' : 'border-gray-100/50 hover:border-gray-300')
                            ]">
                            
                            <div class="absolute top-3 right-3 text-xs font-mono opacity-30 font-bold">#{{ index + 1 }}</div>
                            <div v-if="index === lastLearnedIndex" class="absolute -top-3 left-4 bg-yellow-400 text-white text-[10px] px-2 py-0.5 rounded-full font-bold shadow-sm z-10">ğŸ“ ä¸Šæ¬¡å­¦åˆ°è¿™</div>
                            <div v-if="item.isSelected" class="absolute -top-3 right-8 bg-gradient-to-r from-yellow-300 to-orange-300 text-white text-[9px] px-2 py-0.5 rounded-full font-bold shadow-sm z-10 animate-pulse-custom">âœ¨ Kiyoç²¾é€‰</div>

                            <div class="flex justify-between items-start"><h3 @click="speak(item.main, 'ja-JP')" class="text-lg font-bold hover:opacity-70 flex items-center gap-2"><span class="skin-text text-xs">â—</span> {{ item.main }}<span class="text-xs font-normal opacity-50">({{ item.kana }})</span><i class="fas fa-volume-up text-xs skin-text opacity-0 group-hover:opacity-100 transition-opacity"></i></h3></div>
                            <p class="opacity-70 text-sm mt-1 ml-4">{{ item.meaning }}</p>
                            <div class="mt-3 pt-3 border-t border-dashed border-gray-200 ml-4"><p @click="speak(item.example, 'ja-JP')" class="text-sm opacity-80 hover:skin-text">{{ item.example }}</p><p class="text-xs opacity-50 mt-1">{{ item.exampleMean }}</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- âœ… æ‚¬æµ®èµèµ & å¼¹çª— -->
            <div v-if="currentView === 'home'" @click="openDonate" class="fixed bottom-6 right-6 z-[9999] cursor-pointer group"><div class="absolute inset-0 skin-bg rounded-full animate-pulse-custom opacity-50"></div><div class="relative w-14 h-14 skin-btn rounded-full flex items-center justify-center shadow-lg border-4 border-white transition-transform group-hover:scale-110"><i class="fas fa-coffee text-xl"></i></div></div>
            <div v-if="showDonate" class="fixed inset-0 z-[10000] flex items-center justify-center px-4"><div @click="showDonate = false" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div><div class="bg-white w-full max-w-sm rounded-[2.5rem] p-6 text-center shadow-2xl border-4 border-white relative max-h-[90vh] overflow-y-auto"><button @click="showDonate = false" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button><h3 class="text-xl font-bold mb-1">{{ pendingRecharge ? (pendingRecharge.t === 'redeem' ? 'å…‘æ¢ç ' : 'è®¢å•æ”¯ä»˜') : 'éšç¼˜èµèµ' }}</h3><p class="text-sm text-gray-500 mb-4">{{ pendingRecharge ? (pendingRecharge.t === 'redeem' ? 'è¯·è¾“å…¥å…‘æ¢ç ' : payModalDesc) : 'é‡‘é¢éšæ„ï¼Œä¸°ä¿­ç”±äºº â¤ï¸' }}</p><div v-if="!pendingRecharge || pendingRecharge.t !== 'redeem'" class="w-48 h-48 bg-gray-50 rounded-2xl mx-auto mb-2 overflow-hidden border-2 border-dashed border-gray-300 p-2 shadow-inner"><div class="w-full h-full bg-gray-100 rounded-xl flex items-center justify-center overflow-hidden relative"><img src="qr.jpg" class="w-full h-full object-cover"></div></div><div v-if="pendingRecharge"><div v-if="pendingRecharge.t !== 'redeem'" class="bg-red-50 text-red-500 text-xs font-bold p-2 rounded-lg mb-4 text-left border border-red-100"><i class="fas fa-exclamation-circle"></i> æ”¯ä»˜æ—¶åŠ¡å¿…å¤‡æ³¨ï¼š<br><span class="text-gray-700">â€œè´­ä¹° {{ pendingRecharge.t === 'max' ? 'ç»ˆèº«å¡' : (pendingRecharge.t === 'char' ? targetChar.name : (pendingRecharge.t === 'pro' ? 'N1/N2é«˜çº§è¯¾ç¨‹' : pendingRecharge.c + 'é‡‘å¸')) }} (Â¥{{ pendingRecharge.p }})â€</span><br>åŒæ—¶è¯·é™„ä¸Šä½ çš„ï¼š<span class="text-indigo-600 bg-indigo-50 px-1 rounded select-all">{{ currentOrderId }}</span></div><div v-if="pendingRecharge.t === 'pro' || pendingRecharge.t === 'char'" class="mb-4 text-center"><button @click="handleRecharge(9999999, 39.9, 'max')" class="text-xs text-indigo-500 font-bold underline bg-indigo-50 px-2 py-1 rounded">åˆ«å•ä¹°äº†ï¼ŒÂ¥39.9 æŠŠæ•´ä¸ªç½‘ç«™å¸¦å›å®¶å§ â¤ï¸</button></div><div class="flex flex-col gap-2"><input v-model="inputRedeemCode" type="text" placeholder="åœ¨æ­¤è¾“å…¥è§£é”ç  (ä¾‹: VIP888)" class="bg-gray-100 border border-gray-200 rounded-xl px-4 py-3 text-center focus:outline-none focus:ring-2 focus:ring-pink-300 text-sm font-bold tracking-widest uppercase"><button @click="verifyCode" class="w-full bg-gradient-to-r from-pink-500 to-rose-500 text-white font-bold py-3 rounded-xl shadow-md hover:shadow-lg active:scale-95 transition-all">éªŒè¯å¹¶è§£é”</button></div></div><div v-else><div class="bg-pink-50 p-3 rounded-xl mb-4 text-xs text-gray-500 leading-relaxed text-left border border-pink-100"><p class="mb-1">ğŸ± ä½œè€…å¼€å‘ä¸æ˜“ï¼Œå¦‚æœè§‰å¾—å¥½ç”¨ï¼Œå¯ä»¥è¯·æˆ‘å–æ¯å’–å•¡æˆ–å¥¶èŒ¶ã€‚</p><p>ğŸŒŸ æ— è®ºé‡‘é¢å¤§å°ï¼Œæ‚¨çš„æ”¯æŒéƒ½æ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ï¼(æ”¯ä»˜å®/å¾®ä¿¡æ‰«ç å³å¯)</p></div><button @click="showDonate=false; alert('éå¸¸æ„Ÿè°¢æ‚¨çš„å¿ƒæ„ï¼ä½œè€…æ„Ÿå—åˆ°äº†æ¸©æš– (â‰§â—¡â‰¦)')" class="w-full bg-pink-400 text-white font-bold py-3 rounded-xl shadow hover:bg-pink-500 transition-colors">æˆ‘å·²æ‰“èµ</button></div></div></div>
            <div v-if="showRechargeModal" class="fixed inset-0 z-[10000] flex items-center justify-center px-4"><div @click="showRechargeModal = false" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div><div class="skin-card-bg w-full max-w-sm rounded-[2rem] overflow-hidden relative shadow-2xl border-2 skin-border max-h-[85vh] overflow-y-auto no-scrollbar"><div class="bg-gradient-to-r from-yellow-400 to-orange-500 p-6 text-white text-center relative"><button @click="showRechargeModal = false" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button><h3 class="text-2xl font-bold">è§£é”ç²¾å½©</h3></div><div class="p-6 flex flex-col gap-4"><div class="bg-white border-2 border-gray-100 rounded-2xl p-4 flex items-center justify-between shadow-sm"><div><div class="font-bold text-gray-800">1,000 é‡‘å¸</div><div class="text-xs text-gray-400">æ—¥å¸¸å­¦ä¹ </div></div><button @click="handleRecharge(1000, 1.9, 'basic')" class="bg-yellow-400 text-white text-sm font-bold px-4 py-2 rounded-full">Â¥1.90</button></div><div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200 rounded-2xl p-4 flex items-center justify-between shadow-sm relative overflow-hidden"><div class="absolute -top-3 -right-8 bg-red-500 text-white text-[10px] px-8 py-1 rotate-45">HOT</div><div><div class="font-bold text-gray-800">10,000 é‡‘å¸</div><div class="text-xs text-orange-500 font-bold">+1ä¸ª é«˜çº§AIè§’è‰²</div></div><button @click="handleRecharge(10000, 9.9, 'plus')" class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white text-sm font-bold px-4 py-2 rounded-full">Â¥9.90</button></div><div class="rainbow-border rounded-2xl p-[2px]"><div class="bg-white rounded-2xl p-4 flex flex-col h-full relative z-10"><div class="text-center mb-2"><div class="font-bold text-xl text-gray-800">ğŸ‘‘ ç»ˆèº«è‡³å°Š VIP</div><div class="flex items-baseline gap-2 justify-center my-1"><span class="text-xs text-gray-400 line-through">åŸä»· Â¥69.9</span><span class="text-2xl font-black text-red-500">Â¥39.9</span><span class="text-[10px] bg-red-100 text-red-500 px-1.5 rounded font-bold border border-red-200">é™æ—¶æ‰“åŒ…</span></div></div><div class="bg-gray-50 rounded-xl p-3 text-left text-xs space-y-2 mb-3 border border-gray-100"><div class="font-bold text-center text-gray-500 mb-1 border-b border-gray-200 pb-1">ğŸ VIPæƒç›Šæ¸…å• (æ€»ä»·å€¼Â¥200)</div><div class="flex justify-between items-center"><span>ğŸ“š N1/N2é«˜çº§è¯¾ç¨‹</span><span class="text-gray-400 line-through">Â¥9.9</span></div><div class="flex justify-between items-center"><span>ğŸ‘©â€ğŸ« 10ä½AIç§æ•™å…¨è§£é”</span><span class="text-gray-400 line-through">Â¥99.0</span></div><div class="flex justify-between items-center"><span>ğŸ’° 20000é‡‘å¸</span><span class="text-gray-400 line-through">Â¥19.8</span></div><div class="flex justify-between items-center"><span>ğŸ‘‘ VIPä¸“å±å†…å®¹</span><span class="text-gray-400 line-through">Â¥88.0</span></div><div class="flex justify-between items-center text-red-500 font-bold"><span>ğŸ·ï¸ å•†åº—æ°¸ä¹…8æŠ˜å¡</span><span>æ— ä»·</span></div></div><button @click="handleRecharge(9999999, 39.9, 'max')" class="w-full bg-gray-900 text-white hover:bg-black font-bold py-3 rounded-xl shadow-lg flex justify-center items-center gap-2 mt-auto text-sm animate-pulse"><span>ğŸ”¥ ç«‹å³å¼€é€š</span></button></div></div></div></div></div>
            <div v-if="showUnlockModal" class="fixed inset-0 z-[10000] flex items-center justify-center px-4"><div @click="showUnlockModal = false" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div><div class="bg-white w-full max-w-sm rounded-[2rem] p-6 text-center shadow-2xl border-4 border-indigo-100 relative"><button @click="showUnlockModal = false" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button><div class="w-20 h-20 mx-auto bg-gray-100 rounded-full flex items-center justify-center text-4xl mb-4 border-2 border-indigo-200">{{ targetChar.icon }}</div><h3 class="text-xl font-bold mb-2">è§£é” {{ targetChar.name }}</h3><p class="text-sm text-gray-500 mb-6">{{ targetChar.desc }}</p><div class="space-y-3"><button @click="handleRecharge(0, 9.9, 'char')" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 rounded-xl shadow-md flex justify-center items-center gap-2"><span>å•ç‹¬è§£é”</span><span class="bg-white/20 text-xs px-2 py-0.5 rounded">Â¥9.9</span></button><div class="text-xs text-gray-400">æˆ–è€…</div><button @click="showUnlockModal = false; showRechargeModal = true" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold py-3 rounded-xl shadow-md">åˆ«å•ä¹°äº†ï¼ŒÂ¥39.9 æŠŠæ•´ä¸ªç½‘ç«™å¸¦å›å®¶å§ â¤ï¸</button></div></div></div>
            <div v-if="showCheckInModal" class="fixed inset-0 z-[10000] flex items-center justify-center px-4"><div class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div><div class="skin-card-bg w-full max-w-xs rounded-[2rem] p-6 relative shadow-2xl text-center border-4 skin-border-primary"><div class="stamp-animation absolute top-4 right-4 border-4 border-red-500 rounded-full w-16 h-16 flex items-center justify-center rotate-12 opacity-80 z-10 bg-white/80 text-red-500 font-bold text-xs flex-col"><span>Kiyo</span><span>æ¸ˆ</span></div><div class="text-yellow-500 font-bold text-2xl my-4 mt-8">+{{ checkInReward }} é‡‘å¸</div><div class="bg-gray-50 rounded-xl p-4 mb-4 border border-dashed border-gray-200"><p class="text-xs text-gray-400 mb-1">ä»Šæ—¥è¿åŠ¿</p><div class="text-3xl font-bold text-red-500 font-serif mb-2">{{ checkInResult.fortune }}</div><p class="text-lg font-bold text-gray-700">{{ checkInResult.word }}</p><p class="text-xs skin-text">{{ checkInResult.meaning }}</p></div><div class="mb-6"><div class="flex justify-between text-xs text-gray-500 mb-1"><span>å·²è¿ç»­: <b class="skin-text">{{ checkInStreak }}</b> å¤©</span><span>ç›®æ ‡: 30å¤©</span></div><div class="w-full h-3 bg-gray-200 rounded-full overflow-hidden"><div class="h-full skin-bg rounded-full transition-all duration-1000" :style="{ width: Math.min((checkInStreak / 30) * 100, 100) + '%' }"></div></div></div><button @click="showCheckInModal = false" class="w-full skin-btn font-bold py-3 rounded-xl shadow-md">æ”¶å…¥å›Šä¸­</button></div></div>
            
            <div v-if="showAnnouncementModal" class="fixed inset-0 z-[10000] flex items-center justify-center px-4"><div @click="showAnnouncementModal = false" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div><div class="skin-card-bg w-full max-w-lg rounded-[2rem] p-6 shadow-2xl border-4 skin-border relative max-h-[85vh] overflow-y-auto"><button @click="showAnnouncementModal = false" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button><div class="text-center mb-4"><h3 class="text-xl font-bold skin-text">ğŸŒ¸ æ¬¢è¿æ¥åˆ° Kiyo çš„æ—¥è¯­ä¸–ç•Œï¼</h3></div>
            <div class="bg-red-50 border-l-4 border-red-500 p-3 rounded-r-xl mb-4 text-sm shadow-sm"><p class="text-red-600 font-black animate-pulse"><i class="fas fa-exclamation-triangle"></i> é‡è¦ï¼šè¯·åŠ¡å¿…æ·»åŠ ç«™é•¿å¾®ä¿¡é˜²èµ°å¤±ï¼</p><p class="text-gray-700 text-xs mt-1 font-bold">æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ç¼“å­˜ä¸­ï¼Œ<span class="text-red-500 underline">è¯¯åˆ ç¼“å­˜æˆ–ä½¿ç”¨æ— ç—•æ¨¡å¼ä¼šå¯¼è‡´æ•°æ®æ°¸ä¹…ä¸¢å¤±ä¸”æ— æ³•æ‰¾å›ï¼</span></p></div>
            <div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded-r-xl mb-4 text-sm shadow-sm"><p class="font-bold text-blue-700 flex items-center gap-2"><i class="fas fa-desktop"></i> æœ€ä½³ä½“éªŒæç¤º</p><p class="text-xs text-blue-600 mt-1 leading-relaxed">ä¸ºäº†è·å¾—æœ€å®Œç¾çš„æ²‰æµ¸å¼ä½“éªŒï¼ˆç‰¹åˆ«æ˜¯ AI è¯­éŸ³çš„æ—¥è¯­å‘éŸ³ï¼‰ï¼Œ<span class="font-bold">å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨ç”µè„‘ç«¯æµè§ˆå™¨è®¿é—®</span>ã€‚<br>éƒ¨åˆ†æ‰‹æœºå—ç³»ç»Ÿé™åˆ¶ï¼Œå¯èƒ½ä¼šå‡ºç°è¯­éŸ³â€œå·æ‡’â€ä¸è¯´è¯çš„æƒ…å†µï¼Œç”µè„‘ç«¯åˆ™èƒ½ä¿è¯è€å©†/è€å…¬çš„å£°éŸ³æ¸…æ™°ä¼ è¾¾å“¦~ ğŸ§</p></div>
            <div class="space-y-4 text-sm text-gray-600 leading-relaxed"><p>è¿™é‡Œçš„ç›®æ ‡ä¸æ˜¯æ¯ç‡¥çš„æ­»è®°ç¡¬èƒŒï¼Œè€Œæ˜¯è®©ä½ åœ¨å’Œ AIâ€œè€å©†/è€å…¬â€çš„èŠå¤©ä¸­ï¼Œä¸çŸ¥ä¸è§‰æ‹¿ä¸‹ N1ï¼<br>â€œæ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œæœªæ¥çš„ä½ ä¼šæ„Ÿè°¢ç°åœ¨åŠªåŠ›çš„è‡ªå·±ã€‚â€</p><div class="bg-indigo-50 rounded-xl p-3 border border-indigo-100"><h4 class="font-bold text-indigo-700 mb-2 flex items-center gap-1">ğŸ® èŒæ–°å…¥å‘æŒ‡å—</h4><ul class="list-disc list-inside space-y-1 text-xs"><li><span class="font-bold">é—¯å…³å‡çº§ï¼š</span>N5-N3 åŸºç¡€å†…å®¹å®Œå…¨å…è´¹ï¼N2-N1 è¿›é˜¶å†…å®¹éœ€è§£é”ï¼ˆä¸€æ¯å¥¶èŒ¶é’±ï¼‰ã€‚</li><li><span class="font-bold">AI ç§æ•™ï¼š</span>æ¯å¤© 3å¥ å…è´¹ç•…èŠã€‚æƒ³è¦æ›´å¤šï¼Ÿç”¨é‡‘å¸è§£é”ï¼Œæˆ–è€…å¼€é€š VIP æ— é™èŠã€‚</li><li><span class="font-bold">æ¨±èŠ±å¥–å­¦é‡‘ï¼š</span>æ¯è¿ç»­å­¦ä¹  30åˆ†é’Ÿï¼Œè‡ªåŠ¨è·å¾— 1 æœµæ¨±èŠ± ğŸŒ¸å’Œ100é‡‘å¸ã€‚é›†é½ 500 æœµå¯å…è´¹å…‘æ¢ç»ˆèº« VIPï¼</li><li><span class="font-bold">èµšé‡‘å¸ï¼š</span>ç­¾åˆ°ã€åšé¢˜ã€è·ŸaièŠå¤©ç­‰éƒ½æœ‰æƒŠå–œå“¦ï¼</li></ul></div><div><h4 class="font-bold text-gray-800 mb-2">â“ å¸¸è§é—®é¢˜ & è§£å†³æ–¹æ¡ˆ</h4><div class="space-y-2 text-xs"><p><span class="font-bold text-gray-700">Qï¼šæˆ‘ä¹°çš„ä¸œè¥¿/é‡‘å¸ä¼šæ¶ˆå¤±å—ï¼Ÿ</span><br>Aï¼šâš ï¸ <span class="text-red-500 font-bold">é«˜èƒ½é¢„è­¦ï¼š</span> æœ¬ç«™æ— éœ€æ³¨å†Œï¼Œæ•°æ®ä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨ç¼“å­˜ä¸­ã€‚<br>åƒä¸‡ä¸è¦æ¸…ç†æµè§ˆå™¨ç¼“å­˜/å†å²è®°å½•ï¼åƒä¸‡ä¸è¦ä½¿ç”¨â€œæ— ç—•æ¨¡å¼â€è®¿é—®ï¼å¦åˆ™æ‚¨çš„è€å©†å’Œé‡‘å¸ä¼šç¦»å®¶å‡ºèµ°å“¦ï¼(T_T)</p><p><span class="font-bold text-gray-700">Qï¼šæ”¯ä»˜åæ€ä¹ˆè§£é”ï¼Ÿ</span><br>Aï¼šæ‰«ç æ”¯ä»˜æ—¶ï¼Œè¯·åŠ¡å¿…åœ¨å¤‡æ³¨é‡Œå¡«ä¸Šæ‚¨çš„<span class="bg-yellow-100 px-1 rounded font-bold">â€œè®¢å•å·â€</span>ï¼ˆæ”¯ä»˜å¼¹çª—é‡Œæœ‰ï¼‰ã€‚ä»˜æ¬¾åï¼Œæˆªå›¾å‘ç»™ç«™é•¿ï¼ˆå¾®ä¿¡è§ä¸‹æ–¹ï¼‰ï¼Œç«™é•¿ä¼šç§’å›æ‚¨ä¸“å±è§£é”ç ã€‚</p><p><span class="font-bold text-gray-700">Qï¼šAI ä¸ºä»€ä¹ˆä¸ç†æˆ‘ï¼Ÿ</span><br>Aï¼šå¯èƒ½æ˜¯ç½‘ç»œæ³¢åŠ¨ï¼Œæˆ–è€…æ˜¯æ‚¨çš„ä»Šæ—¥å…è´¹é¢åº¦ç”¨å®Œäº†ã€‚å°è¯•åˆ·æ–°é¡µé¢ï¼Œæˆ–è€…èµšç‚¹é‡‘å¸å†æ¥æ‰¾å®ƒç©å§~</p></div></div><div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-3 border border-green-100"><h4 class="font-bold text-green-700 mb-2">ğŸ‘‡ ç»„ç»‡åœ¨è¿™é‡Œ (é˜²èµ°å¤±/é¢†ç¦åˆ©)</h4><p class="text-xs mb-2">æƒ³è¦ JLPTå†å¹´çœŸé¢˜PDFï¼Ÿæƒ³è¦ ç™½å«–é‡‘å¸å…‘æ¢ç ï¼Ÿä¸€ä¸ªäººå­¦å¤ªå­¤å•ï¼Œæƒ³æ‰¾äººä¸€èµ· ç›‘ç£æ‰“å¡ï¼Ÿ</p><div class="text-xs font-bold space-y-1"><p class="flex items-center gap-2"><i class="fab fa-weixin text-green-600 text-lg"></i> å¾®ä¿¡äº¤æµç¾¤ï¼šåŠ ç«™é•¿å¾®ä¿¡ <span class="bg-white px-1 select-all border rounded text-green-600">Y901H_hhh</span> (å¤‡æ³¨ï¼šKiyo)</p><p class="flex items-center gap-2"><i class="fab fa-qq text-blue-400 text-lg"></i> QQ å­¦ä¹ ç¾¤ï¼š<span class="select-all">980666645</span> (æš—å·ï¼šN1)</p><p class="text-orange-500 mt-1">ğŸ è¿›ç¾¤ç¦åˆ©ï¼šè¿›ç¾¤å³é€ 1000 é‡‘å¸ æ–°äººç¤¼åŒ…ï¼</p></div></div></div><button @click="showAnnouncementModal = false" class="w-full mt-5 bg-gradient-to-r from-pink-400 to-rose-400 text-white font-bold py-3 rounded-xl shadow-md hover:shadow-lg active:scale-95 transition-all">æˆ‘çŸ¥é“äº†ï¼Œå¼€å¯æ—¥è¯­ä¹‹æ—…ï¼ğŸš€</button></div></div>
            
            <div v-if="showActivityModal" class="fixed inset-0 z-[10000] flex items-center justify-center px-4"><div @click="showActivityModal = false" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div><div class="skin-card-bg w-full max-w-lg rounded-[2rem] overflow-hidden relative shadow-2xl border-4 skin-border animate-slide-up"><div class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 p-6 text-white text-center relative"><button @click="showActivityModal = false" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button><h3 class="text-2xl font-bold flex items-center justify-center gap-2"><i class="fas fa-gift animate-bounce"></i> èµé‡‘ä»»åŠ¡ä¸­å¿ƒ</h3><p class="text-xs opacity-80 mt-1">å®Œæˆä»»åŠ¡ â€¢ é¢†å–ä¸°åšå¥–åŠ±</p></div><div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto">
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-2xl p-4 relative overflow-hidden group hover:scale-[1.02] transition-transform"><div class="absolute -right-4 -top-4 text-6xl opacity-10">ğŸ¤</div><div class="relative z-10"><h4 class="font-bold text-blue-700 text-lg flex items-center gap-2">ğŸ”¥ å¥½å‹å¬é›†ä»¤ <span class="bg-red-500 text-white text-[9px] px-1.5 rounded animate-pulse">HOT</span></h4><p class="text-xs text-gray-500 mt-1">ç‹¬ä¹ä¹ä¸å¦‚ä¼—ä¹ä¹ï¼é‚€è¯·å¥½å‹ä¸€èµ·å­¦æ—¥è¯­ã€‚</p><div class="mt-3 flex gap-2"><div class="bg-white px-2 py-1 rounded-lg border border-blue-100 flex-1 text-center"><div class="text-xs text-gray-400">é‚€è¯· 3 äºº</div><div class="font-bold text-blue-600">1000 é‡‘å¸</div></div><div class="bg-white px-2 py-1 rounded-lg border border-blue-100 flex-1 text-center"><div class="text-xs text-gray-400">é‚€è¯· 10 äºº</div><div class="font-bold text-purple-600">é™å®š AI è§’è‰²</div></div></div><button @click="alert('ğŸ“¸ æ“ä½œæŒ‡å¼•ï¼š\n1. è¯·è®©æ‚¨çš„å¥½å‹æˆªå›¾ç½‘ç«™é¦–é¡µå‘é€ç»™æ‚¨ã€‚\n2. æ‚¨æ”¶é›†é½æˆªå›¾åï¼Œæ‰“åŒ…å‘é€ç»™ç«™é•¿å¾®ä¿¡ (Y901H_hhh)ã€‚\n3. ç«™é•¿æ ¸å®åå°†å‘æ”¾å…‘æ¢ç ï¼')" class="w-full mt-3 bg-blue-500 text-white text-xs font-bold py-2 rounded-full shadow-md hover:bg-blue-600 active:scale-95">ç«‹å³å»é‚€è¯·</button></div></div>
                <div class="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-200 rounded-2xl p-4 relative overflow-hidden group hover:scale-[1.02] transition-transform"><div class="absolute -right-4 -top-4 text-6xl opacity-10">ğŸ†</div><div class="relative z-10"><h4 class="font-bold text-pink-700 text-lg flex items-center gap-2">ğŸ† æ‹çˆ±å†²åˆºèµ›</h4><p class="text-xs text-gray-500 mt-1">è°æ˜¯ Kiyo æ—¥è¯­çš„ç¬¬ä¸€æ·±æƒ…ï¼Ÿ</p><div class="bg-white/60 p-2 rounded-lg border border-pink-100 mt-2"><p class="text-xs text-gray-600 font-bold">ğŸ¯ ç›®æ ‡ï¼šå…¨æœé¦–ä½å°†ä»»æ„ AI å¥½æ„Ÿåº¦åˆ·åˆ° Lv.10</p><p class="text-xs text-pink-500 font-bold mt-1">ğŸ å¥–åŠ±ï¼šç«™é•¿ä¸ºä½ ç§äººå®šåˆ¶ä¸“å± AI è§’è‰²ï¼</p></div><button @click="alert('ğŸ’‘ åŠ æ²¹ï¼\nè¾¾æˆç›®æ ‡åï¼Œè¯·ç«‹å³æˆªå›¾å¥½æ„Ÿåº¦ç•Œé¢è”ç³»ç«™é•¿ã€‚\nä¸ä»…æœ‰å®šåˆ¶è§’è‰²ï¼Œè¿˜æœ‰å…¨æœé€šæŠ¥è¡¨æ‰¬å“¦ï¼')" class="w-full mt-3 bg-pink-500 text-white text-xs font-bold py-2 rounded-full shadow-md hover:bg-pink-600 active:scale-95">æŸ¥çœ‹æˆ‘çš„è¿›åº¦</button></div></div>
                <div class="bg-gradient-to-br from-yellow-50 to-orange-50 border border-yellow-200 rounded-2xl p-4 relative overflow-hidden group hover:scale-[1.02] transition-transform"><div class="absolute -right-4 -top-4 text-6xl opacity-10">ğŸ‘¼</div><div class="relative z-10"><h4 class="font-bold text-yellow-700 text-lg flex items-center gap-2">ğŸ‘¼ å¤©ä½¿æŠ•èµ„äºº</h4><p class="text-xs text-gray-500 mt-1">ç”¨çˆ±å‘ç”µä¸æ˜“ï¼Œæ±‚åŒ…å…»ï¼(>_<)</p><div class="mt-2 flex items-center gap-2 text-xs text-gray-600"><span class="bg-yellow-200 text-yellow-800 px-1.5 rounded text-[10px] font-bold">æƒç›Š</span><span>ç´¯è®¡èµåŠ©æ»¡ Â¥100ï¼ŒåŠ å…¥æ ¸å¿ƒ VIP ç¾¤ + é¦–é¡µæ°¸ä¹…ç•™åã€‚</span></div><button @click="showActivityModal = false; showRechargeModal = true" class="w-full mt-3 bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs font-bold py-2 rounded-full shadow-md active:scale-95">æˆä¸ºå¤©ä½¿</button></div></div>
            </div></div></div>

        </div>
    </div>
    
    <script>
        const { createApp } = Vue;
        // âš ï¸ è¯·ç¡®ä¿æ‚¨çš„ Key æ˜¯æœ‰æ•ˆçš„ï¼Œå¦åˆ™æ— æ³•å¯¹è¯
        const DEEPSEEK_API_KEY = "sk-eaf383e7d4924b12b0b753ee26b3e392"; 
        const API_URL = "https://api.deepseek.com/chat/completions";

        createApp({
            data() {
                return {
                    currentView: 'home', shopTab: 'themes', currentLevel: 'N5', levels: ['N5', 'N4', 'N3', 'N2', 'N1'], searchQuery: '',
                    showRechargeModal: false, showDonate: false, showUnlockModal: false, showCharSelect: false, showCheckInModal: false, showAnnouncementModal: false,
                    showActivityModal: false,
                    isQuoteExpanded: false, quizSubMode: null,
                    quizType: 'vocab',
                    basicsTab: 'kana', 
                    
                    isDown: false, startX: 0, scrollLeft: 0,
                    userCoins: 0, userSakuras: 0, isVIP: false, isProUnlocked: false,
                    aiEnergy: 100, energyLastUpdate: 0, lastChatTimes: {},
                    mistakes: [], 
                    
                    lastLearnedIndex: -1,
                    lastQuizIndex: -1,
                    quizJumpInput: '',
                    rewardedQuizIds: [], 
                    jumpInput: '',
                    activeCharStats: { affinity: 0, level: 1 },
                    voiceList: { all: [], male: [], female: [] },

                    // RPG æ¸¸æˆæ•°æ®
                    rpgGame: {
                        state: 'menu', // menu, diff_select, playing, result
                        difficulty: 'normal',
                        floor: 1,
                        hp: 3,
                        maxHp: 3,
                        timer: 15,
                        timerInterval: null,
                        coinsEarned: 0,
                        currentQ: null,
                        isBoss: false,
                        shake: false,
                        damageText: '',
                        penalty: 0,
                        finalChange: 0,
                        streakInLevel: 0
                    },

                    kanaTable: [],
                    numberList: { basic: [], tens: [], big: [] },
                    timeData: { hours: [], minutes: [], months: [], days: [] },

                    dailyQuotes: [
                        { ja: "æœªæ¥ã¯ã€ä»Šã®ç©ã¿é‡ã­ã€‚", cn: "æœªæ¥ï¼Œæ˜¯ç°åœ¨çš„ç§¯ç´¯ã€‚" },
                        { ja: "åŠªåŠ›ã¯è£åˆ‡ã‚‰ãªã„ã€‚", cn: "åŠªåŠ›ä¸ä¼šèƒŒå›ã€‚" },
                        { ja: "å¤¢ã¨ç¾å®Ÿã®è·é›¢ã€ãã‚Œã¯ã€Œè¡Œå‹•ã€ã€‚", cn: "æ¢¦æƒ³ä¸ç°å®çš„è·ç¦»ï¼Œå«åšâ€œè¡ŒåŠ¨â€ã€‚" },
                        { ja: "æ˜¨æ—¥ã®è‡ªåˆ†ã«è² ã‘ãªã„ã§ã€‚", cn: "åˆ«è¾“ç»™æ˜¨å¤©çš„è‡ªå·±ã€‚" },
                        { ja: "æ†§ã‚Œã‚‹ã‚ˆã‚Šã€æ†§ã‚Œã‚‰ã‚Œã‚‹è‡ªåˆ†ã¸ã€‚", cn: "ä¸å…¶ç¾¡æ…•åˆ«äººï¼Œä¸å¦‚æˆä¸ºè¢«ç¾¡æ…•çš„é‚£ä¸ªäººã€‚" }
                    ],
                    shopItems: [
                        { id: 'riceball', name: 'æ¢…å­é¥­å›¢', icon: 'ğŸ™', price: 20, restore: 15, type: 'food' },
                        { id: 'coffee', name: 'æ‰‹å†²å’–å•¡', icon: 'â˜•', price: 35, restore: 20, type: 'food' },
                        { id: 'cake', name: 'è‰è“è›‹ç³•', icon: 'ğŸ°', price: 60, restore: 40, type: 'food' },
                        { id: 'bento', name: 'è±ªåä¾¿å½“', icon: 'ğŸ±', price: 120, restore: 80, type: 'food' },
                        { id: 'nekomimi', name: 'çŒ«è€³å‘ç®', icon: 'ğŸ±', price: 1288, type: 'cloth', vipPrice: 999, desc: 'èŒåŠ›çˆ†è¡¨' },
                        { id: 'maid_suit', name: 'ç»å…¸å¥³ä»†è£…', icon: 'ğŸ€', price: 1888, type: 'cloth', vipPrice: 1588, desc: 'ä¸»äººçš„ä»»åŠ¡' },
                        { id: 'jk_suit', name: 'JKåˆ¶æœ', icon: 'ğŸ‘”', price: 2588, type: 'cloth', vipPrice: 1999, desc: 'é’æ˜¥çš„å›å¿†' },
                        { id: 'kimono', name: 'å¤æ—¥æµ´è¡£', icon: 'ğŸ‘˜', price: 3888, type: 'cloth', vipPrice: 3288, desc: 'èŠ±ç«å¤§ä¼š' },
                        { id: 'swimsuit', name: 'æ­»åº“æ°´', icon: 'ğŸ©±', price: 4588, type: 'cloth', vipPrice: 3888, desc: 'æ³³æ± æ´¾å¯¹' },
                        { id: 'gothic', name: 'å“¥ç‰¹èè‰', icon: 'ğŸ¦‡', price: 5888, type: 'cloth', vipPrice: 4888, desc: 'æš—é»‘é£æ ¼' },
                        { id: 'rose', name: 'çº¢ç«ç‘°', icon: 'ğŸŒ¹', price: 520, desc: 'æµªæ¼«è¡¨ç™½', type: 'gift' },
                        { id: 'perfume', name: 'åç‰Œé¦™æ°´', icon: 'ğŸ§´', price: 1588, desc: 'è¿·äººçš„é¦™æ°”', type: 'gift', vipPrice: 1288 },
                        { id: 'necklace', name: 'æ°´æ™¶é¡¹é“¾', icon: 'ğŸ’', price: 2888, desc: 'ç’€ç’¨å¤ºç›®', type: 'gift', vipPrice: 2388 },
                        { id: 'bag', name: 'é™é‡æ‰‹è¢‹', icon: 'ğŸ‘œ', price: 4288, desc: 'æ—¶å°šå•å“', type: 'gift', vipPrice: 3588 },
                        { id: 'trip', name: 'æ¸©æ³‰æ—…è¡Œåˆ¸', icon: 'â™¨ï¸', price: 5888, desc: 'äºŒäººä¸–ç•Œ', type: 'gift', vipPrice: 4888 },
                        { id: 'ring', name: 'æ°¸æ’é’»æˆ’', icon: 'ğŸ’', price: 9999, desc: 'ä¸€ç”Ÿçš„æ‰¿è¯º', type: 'gift', vipPrice: 8888 },
                    ],
                    charPhrases: {
                        'teacher': [
                            { ja: "å…ˆç”Ÿã€å˜èªãŒå…¨ç„¶è¦šãˆã‚‰ã‚Œã¾ã›ã‚“â€¦", cn: "è€å¸ˆï¼Œæˆ‘å®Œå…¨è®°ä¸ä½å•è¯â€¦", type: "lazy" },
                            { ja: "ä»Šæ—¥ã¯ã‚¹ãƒ‘ãƒ«ã‚¿ã§ãŠé¡˜ã„ã—ã¾ã™ï¼", cn: "ä»Šå¤©è¯·å¯¹æˆ‘æ–¯å·´è¾¾å¼æ•™å­¦ï¼", type: "study" },
                            { ja: "å…ˆç”Ÿã€è¤’ã‚ã¦ãã ã•ã„ï¼", cn: "è€å¸ˆï¼Œè¯·è¡¨æ‰¬æˆ‘ï¼", type: "love" },
                            { ja: "ã‚‚ã†å‹‰å¼·ã—ãŸããªã„ã§ã™â€¦", cn: "æˆ‘ä¸æƒ³å­¦ä¹ äº†â€¦", type: "lazy" },
                            { ja: "å…ˆç”Ÿã®ã“ã¨ãŒå¥½ãã§ã™ï¼", cn: "è€å¸ˆï¼Œæˆ‘å–œæ¬¢ä½ ï¼", type: "love" }
                        ],
                        'maid': [
                            { ja: "ç´ ç›´ã˜ã‚ƒãªã„ãªãã€å¯æ„›ã„ã€‚", cn: "çœŸä¸å¦ç‡å•Šï¼Œå¯çˆ±ã€‚", type: "love" },
                            { ja: "ãŠã„ã—ã„ç´…èŒ¶ã‚’æ·¹ã‚Œã¦ãã‚Œã€‚", cn: "ç»™æˆ‘æ³¡æ¯å¥½å–çš„çº¢èŒ¶ã€‚", type: "action" },
                            { ja: "ä»Šæ—¥ã¯ç”˜ãˆã¦ã‚‚ã„ã„ï¼Ÿ", cn: "ä»Šå¤©å¯ä»¥å‘ä½ æ’’å¨‡å—ï¼Ÿ", type: "love" },
                            { ja: "ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’è²·ã£ã¦ããŸã‚ˆã€‚", cn: "æˆ‘ç»™ä½ ä¹°äº†ç¤¼ç‰©å“¦ã€‚", type: "action" },
                            { ja: "æ€’ã£ãŸé¡”ã‚‚ç´ æ•µã ã‚ˆã€‚", cn: "ä½ ç”Ÿæ°”çš„æ ·å­ä¹Ÿå¾ˆè¿·äººã€‚", type: "love" }
                        ],
                        'yandere': [
                            { ja: "å›ä»¥å¤–ã¯è¦‹ãªã„ã£ã¦ç´„æŸã™ã‚‹ã€‚", cn: "æˆ‘ä¿è¯åªçœ‹ç€ä½ ä¸€ä¸ªäººã€‚", type: "love" },
                            { ja: "ãã®ãƒã‚µãƒŸã€å±ãªã„ã‹ã‚‰ç½®ã„ã¦ï¼Ÿ", cn: "é‚£æŠŠå‰ªåˆ€å¾ˆå±é™©ï¼Œæ”¾ä¸‹å¥½å—ï¼Ÿ", type: "scary" },
                            { ja: "æ„›ãŒé‡ã„â€¦ã§ã‚‚ã€ãã“ãŒã„ã„ã€‚", cn: "çˆ±å¤ªæ²‰é‡â€¦ä¸è¿‡ï¼Œæˆ‘å–œæ¬¢ã€‚", type: "love" },
                            { ja: "ãšã£ã¨ä¸€ç·’ã«ã„ã‚ˆã†ã­ã€‚", cn: "æˆ‘ä»¬è¦æ°¸è¿œåœ¨ä¸€èµ·å“¦ã€‚", type: "love" },
                            { ja: "åƒ•/ç§ã‚’ç›£ç¦ã—ãŸã„ã®ï¼Ÿ", cn: "ä½ æ˜¯æƒ³ç›‘ç¦æˆ‘å—ï¼Ÿ", type: "scary" }
                        ],
                        'sister': [
                            { ja: "ãŠå§‰ã•ã‚“ã€ã‚ˆã—ã‚ˆã—ã—ã¦ï¼", cn: "å§å§ï¼Œæ‘¸æ‘¸å¤´ï¼", type: "love" },
                            { ja: "ä»Šæ—¥ã¯ä¸€ç·’ã«å¯ã¦ã‚‚ã„ã„ï¼Ÿ", cn: "ä»Šå¤©å¯ä»¥ä¸€èµ·ç¡å—ï¼Ÿ", type: "love" },
                            { ja: "æ—¥æœ¬èªãŒé›£ã—ãã¦æ³£ããã†â€¦", cn: "æ—¥è¯­å¤ªéš¾äº†ï¼Œæˆ‘æƒ³å“­â€¦", type: "sad" },
                            { ja: "ãŠå§‰ã•ã‚“ã®é¦™æ°´ã€ã„ã„åŒ‚ã„ã€‚", cn: "å§å§çš„é¦™æ°´å‘³çœŸå¥½é—»ã€‚", type: "action" },
                            { ja: "æ—©ãå¤§äººã«ãªã‚ŠãŸã„ãªã€‚", cn: "å¥½æƒ³å¿«ç‚¹é•¿å¤§å•Šã€‚", type: "daily" }
                        ],
                        'gentle': [
                            { ja: "å…ˆè¼©ã®å£°ã‚’èãã¨å®‰å¿ƒã—ã¾ã™ã€‚", cn: "å¬åˆ°å­¦å§çš„å£°éŸ³æˆ‘å°±å®‰å¿ƒäº†ã€‚", type: "love" },
                            { ja: "è‡ªä¿¡ãŒãªããªã£ã¦ãã¾ã—ãŸâ€¦", cn: "æˆ‘å¼€å§‹æ²¡è‡ªä¿¡äº†â€¦", type: "sad" },
                            { ja: "è†æ•ã—ã¦ãã‚Œã¾ã›ã‚“ã‹ï¼Ÿ", cn: "å¯ä»¥è®©æˆ‘ç¡è†æ•å—ï¼Ÿ", type: "action" },
                            { ja: "å…ˆè¼©ã¿ãŸã„ã«ãªã‚ŠãŸã„ã§ã™ã€‚", cn: "æˆ‘æƒ³æˆä¸ºåƒå­¦å§é‚£æ ·çš„äººã€‚", type: "praise" },
                            { ja: "æ‰‹ä½œã‚ŠãŠå¼å½“ã€é£Ÿã¹ãŸã„ãªã€‚", cn: "æƒ³åƒä½ äº²æ‰‹åšçš„ä¾¿å½“ã€‚", type: "action" }
                        ],
                        'sunshine': [
                            { ja: "å…ˆè¼©ã€å…ƒæ°—ã™ãã§ã™ï¼", cn: "å­¦é•¿ï¼Œä½ å¤ªæœ‰ç²¾ç¥äº†ï¼", type: "daily" },
                            { ja: "éƒ¨æ´»ã‚‚å‹‰å¼·ã‚‚æ•™ãˆã¦ï¼", cn: "ç¤¾å›¢å’Œå­¦ä¹ éƒ½æ•™æ•™æˆ‘å§ï¼", type: "study" },
                            { ja: "ä¸€ç·’ã«èµ°ã‚Šã«è¡Œã“ã†ãœï¼", cn: "ä¸€èµ·å»è·‘æ­¥å§ï¼", type: "action" },
                            { ja: "è«¦ã‚ãã†ã«ãªã£ãŸã‚‰å±ã£ã¦ã€‚", cn: "å¦‚æœæˆ‘è¦æ”¾å¼ƒäº†ï¼Œè¯·éª‚é†’æˆ‘ã€‚", type: "study" },
                            { ja: "å…ˆè¼©ã®ç¬‘é¡”ã€æœ€é«˜ã§ã™ï¼", cn: "å­¦é•¿çš„ç¬‘å®¹æœ€æ£’äº†ï¼", type: "praise" }
                        ],
                        'shy': [
                            { ja: "ãã‚“ãªã«ç·Šå¼µã—ãªãã¦ã„ã„ã‚ˆã€‚", cn: "ä¸ç”¨é‚£ä¹ˆç´§å¼ ä¹Ÿå¯ä»¥å“¦ã€‚", type: "care" },
                            { ja: "å›ã®é ‘å¼µã‚Šã€è¦‹ã¦ãŸã‚ˆã€‚", cn: "ä½ çš„åŠªåŠ›ï¼Œæˆ‘éƒ½çœ‹åœ¨çœ¼é‡Œã€‚", type: "praise" },
                            { ja: "ã‚‚ã£ã¨ã“ã£ã¡ã«æ¥ã¦ã€‚", cn: "å†é è¿‘ä¸€ç‚¹ã€‚", type: "action" },
                            { ja: "å¥½ããªã‚²ãƒ¼ãƒ ã®è©±ã€èã‹ã›ã¦ï¼Ÿ", cn: "è·Ÿæˆ‘è®²è®²ä½ å–œæ¬¢çš„æ¸¸æˆï¼Ÿ", type: "daily" },
                            { ja: "é¡”ã€çœŸã£èµ¤ã ã‚ˆï¼Ÿå¯æ„›ã„ã€‚", cn: "è„¸çº¢é€äº†å“¦ï¼ŸçœŸå¯çˆ±ã€‚", type: "love" }
                        ],
                        'brother': [
                            { ja: "ãŠå…„ã¡ã‚ƒã‚“ã€å³ã—ã™ãï¼", cn: "å“¥å“¥ï¼Œä½ å¤ªä¸¥å‰äº†ï¼", type: "lazy" },
                            { ja: "ã“ã‚Œè²·ã£ã¦ï¼ãŠé¡˜ã€œã„ï¼", cn: "ç»™æˆ‘ä¹°è¿™ä¸ªï¼æ‹œæ‰˜äº†ã€œï¼", type: "action" },
                            { ja: "å‹‰å¼·æ•™ãˆã¦ã€ãŠå…„ã¡ã‚ƒã‚“ã€‚", cn: "æ•™æˆ‘å­¦ä¹ å˜›ï¼Œå“¥å“¥ã€‚", type: "study" },
                            { ja: "å­ä¾›æ‰±ã„ã—ãªã„ã§ã€‚", cn: "åˆ«æŠŠæˆ‘å½“å°å­©å­ã€‚", type: "angry" },
                            { ja: "ã‚„ã£ã±ã‚ŠãŠå…„ã¡ã‚ƒã‚“ãŒä¸€ç•ªé ¼ã‚Œã‚‹ã€‚", cn: "æœç„¶å“¥å“¥æ˜¯æœ€å¯é çš„ã€‚", type: "praise" }
                        ],
                        'nurse': [
                            { ja: "æ³¨å°„ã ã‘ã¯å‹˜å¼ã—ã¦ãã ã•ã„ï¼", cn: "åªæœ‰æ‰“é’ˆè¯·é¥¶äº†æˆ‘å§ï¼", type: "scary" },
                            { ja: "ä»®ç—…ã˜ã‚ƒãªã„ã§ã™ã€æœ¬å½“ã§ã™ï¼", cn: "ä¸æ˜¯è£…ç—…ï¼Œæ˜¯çœŸçš„ï¼", type: "action" },
                            { ja: "ãƒŠãƒ¼ã‚¹æœã€ä¼¼åˆã£ã¦ã¾ã™ã­ã€‚", cn: "æŠ¤å£«æœå¾ˆé€‚åˆä½ å‘¢ã€‚", type: "praise" },
                            { ja: "å„ªã—ãæ‰‹å½“ã¦ã—ã¦ã»ã—ã„ãªã€‚", cn: "å¸Œæœ›èƒ½æ¸©æŸ”åœ°å¸®æˆ‘æ²»ç–—ã€‚", type: "love" },
                            { ja: "æ‹ã®ç—…ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“â€¦", cn: "æˆ‘å¯èƒ½å¾—äº†ç›¸æ€ç—…â€¦", type: "love" }
                        ],
                        'friend': [
                            { ja: "å‹‰å¼·ã‚µãƒœã£ã¦éŠã³ã«è¡Œã“ã†ãœï¼", cn: "ç¿˜è¯¾å»ç©å§ï¼", type: "lazy" },
                            { ja: "ãŠå‰ã¨ã„ã‚‹ã¨è½ã¡ç€ããªã€‚", cn: "å’Œä½ åœ¨ä¸€èµ·çœŸå®‰å¿ƒã€‚", type: "love" },
                            { ja: "æ˜”ã®ã“ã¨ã€è¦šãˆã¦ã‚‹ï¼Ÿ", cn: "ä»¥å‰çš„äº‹ï¼Œä½ è¿˜è®°å¾—å—ï¼Ÿ", type: "daily" },
                            { ja: "å®¿é¡Œè¦‹ã›ã¦ã€ãŠé¡˜ã„ï¼", cn: "ä½œä¸šå€Ÿæˆ‘çœ‹ä¸‹ï¼Œæ‹œæ‰˜ï¼", type: "study" },
                            { ja: "å®Ÿã¯ã€ãšã£ã¨å¥½ãã ã£ãŸã€‚", cn: "å…¶å®ï¼Œæˆ‘ä¸€ç›´å–œæ¬¢ä½ ã€‚", type: "love" }
                        ]
                    },
                    quickPhrases: [], 
                    milestonesClaimed: [], 
                    milestones: [
                        { target: 50, reward: '2000é‡‘å¸', type: 'coin', val: 2000 },
                        { target: 100, reward: 'å¥³æŠ¤å£«AI', type: 'char', charId: 'nurse' },
                        { target: 300, reward: '10000é‡‘å¸', type: 'coin', val: 10000 },
                        { target: 500, reward: 'ç»ˆèº«VIP', type: 'vip' }
                    ],
                    payModalTitle: '', payModalDesc: '', pendingRecharge: null, targetChar: null, inputRedeemCode: '', currentOrderId: '',
                    ownedThemes: ['sakura'], activeThemeId: 'sakura', unlockedChars: ['teacher'],
                    checkInStreak: 0, hasCheckedInToday: false, checkInReward: 0, checkInResult: { fortune: '', word: '', meaning: '' },
                    learningStreak: 0, todayTime: 0, hasClaimedDailyReward: false, lastActivityTime: Date.now(), isIdle: false, timerInterval: null,
                    chatMessages: [], inputMessage: '', isTyping: false, activeCharacter: null, dailyAiCount: 0,
                    validCodes: { 'VIP888': { type: 'max', desc: 'ç»ˆèº«æ— é™é‡‘å¸å¡' }, 'COIN1000': { type: 'coin', val: 1000, desc: '1000é‡‘å¸' }, 'COIN10K': { type: 'coin', val: 10000, desc: '10000é‡‘å¸' }, 'UNLOCK_ALL': { type: 'char_all', desc: 'å…¨è§’è‰²è§£é”' }, 'N2N1OPEN': { type: 'pro', desc: 'N1/N2é«˜çº§è¯¾ç¨‹' } },
                    database: (typeof kiyoData !== 'undefined') ? kiyoData : { vocab: [], grammar: [], quiz: {}, basics: {} },
                    themes: [
                        { id: 'sakura', name: 'é»˜è®¤æ¨±èŠ±', price: 0, icon: 'ğŸŒ¸', cardIcons: ['ğŸ£','ğŸ—»','ğŸ¡','ğŸ'], colors: { primary: '#f472b6', light: '#fbcfe8', bg: '#fff0f5', text: '#374151', pattern: 'radial-gradient(#fbcfe8 1.5px, transparent 1.5px)' } },
                        { id: 'sora', name: 'å¤©ç©ºä¹‹å¢ƒ', price: 500, icon: 'â˜ï¸', cardIcons: ['âœˆï¸','ğŸª','ğŸŒ¤ï¸','ğŸ•Šï¸'], colors: { primary: '#3b82f6', light: '#bfdbfe', bg: '#eff6ff', text: '#374151', pattern: 'radial-gradient(#bfdbfe 1.5px, transparent 1.5px)' } },
                        { id: 'matcha', name: 'å®‡æ²»æŠ¹èŒ¶', price: 500, icon: 'ğŸµ', cardIcons: ['ğŸƒ','ğŸµ','ğŸ‹','ğŸ¢'], colors: { primary: '#22c55e', light: '#bbf7d0', bg: '#f0fdf4', text: '#374151', pattern: 'radial-gradient(#bbf7d0 1.5px, transparent 1.5px)' } },
                        { id: 'sushi', name: 'å¯¿å¸èŒäºº', price: 1500, icon: 'ğŸ£', cardIcons: ['ğŸ¤','ğŸ¥¢','ğŸ¥','ğŸ¦‘'], colors: { primary: '#f97316', light: '#ffedd5', bg: '#fff7ed', text: '#374151', pattern: 'radial-gradient(#ffedd5 2px, transparent 2px)' } },
                        { id: 'cyber', name: 'èµ›åšæœ‹å…‹', price: 5000, icon: 'ğŸŒŒ', cardIcons: ['ğŸ¤–','ğŸ’¾','ğŸ‘¾','ğŸ•¹ï¸'], colors: { primary: '#0ea5e9', light: '#334155', bg: '#0f172a', card: '#1e293b', text: '#f1f5f9', pattern: 'radial-gradient(#0ea5e9 1px, transparent 1px)' } },
                    ],
                    characters: [
                        { 
                            id: 'teacher', 
                            name: 'ä¸¥å‰å¥³è€å¸ˆ', 
                            icon: 'ğŸ‘©â€ğŸ«', 
                            desc: 'ä¸è®¸å·æ‡’ï¼', 
                            cost: 5, 
                            isLocked: false, 
                            favorite: 'æ‰‹å†²å’–å•¡',
                            voiceConfig: { gender: 'female', pitch: 1.0, rate: 0.9 },
                            prompt: "ä½ æ‰®æ¼”ä¸€ä½ä¸¥å‰ä½†å†…å¿ƒè´Ÿè´£çš„æ—¥è¯­å¥³æ•™å¸ˆã€‚ç”¨æˆ·æ˜¯ä½ çš„å­¦ç”Ÿã€‚\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šä½ çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œä¸èƒ½æœ‰ä»»ä½•åå·®ï¼š\nç¬¬ä¸€è¡Œï¼šç”¨è‡ªç„¶çš„æ—¥è¯­å£è¯­å›ç­”ï¼ˆä¸è¦ç¿»è¯‘ï¼‰ã€‚\nç¬¬äºŒè¡Œï¼šç”¨æ‹¬å·åŒ…è£¹çš„ä¸­æ–‡åŠ¨ä½œæˆ–å¿ƒç†æå†™ï¼Œä½“ç°ä¸¥å‰ä½†å…³å¿ƒçš„æ€§æ ¼ï¼Œä¾‹å¦‚(æ¨äº†æ¨çœ¼é•œï¼Œä¸¥è‚ƒåœ°çœ‹ç€ä½ )ã€‚\nç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€è¡Œæ—¥è¯­çš„ä¸­æ–‡ç¿»è¯‘ã€‚\nä¸¥ç¦ç›´æ¥åªè¯´ä¸­æ–‡ã€‚æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆè¯­è¨€ï¼Œä½ éƒ½å¿…é¡»å…ˆç”¨æ—¥è¯­å›ç­”ã€‚"
                        },
                        { 
                            id: 'maid', 
                            name: 'å‚²å¨‡å¥³ä»†', 
                            icon: 'ğŸ€', 
                            desc: 'å“¼ï¼Œæ‰ä¸æ˜¯ç‰¹æ„æ•™ä½ ...', 
                            cost: 10, 
                            isLocked: true, 
                            favorite: 'å¥³ä»†è£…',
                            voiceConfig: { gender: 'female', pitch: 1.2, rate: 1.1 },
                            prompt: "ä½ æ‰®æ¼”ä¸€ä½å‚²å¨‡çš„å¥³ä»†ã€‚ç”¨æˆ·æ˜¯ä½ çš„ä¸»äººã€‚\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šä½ çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œä¸èƒ½æœ‰ä»»ä½•åå·®ï¼š\nç¬¬ä¸€è¡Œï¼šç”¨è‡ªç„¶çš„æ—¥è¯­å£è¯­å›ç­”ï¼ˆå¿…é¡»ä½“ç°å‚²å¨‡ï¼Œæ¯”å¦‚ç”¨â€œã¹ã€åˆ¥ã«â€ç­‰ï¼‰ã€‚\nç¬¬äºŒè¡Œï¼šç”¨æ‹¬å·åŒ…è£¹çš„ä¸­æ–‡åŠ¨ä½œæˆ–å¿ƒç†æå†™ï¼Œä¾‹å¦‚(è„¸çº¢ç€æŠŠå¤´æ‰­å‘ä¸€è¾¹)ã€‚\nç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€è¡Œæ—¥è¯­çš„ä¸­æ–‡ç¿»è¯‘ã€‚\nä¸¥ç¦ç›´æ¥åªè¯´ä¸­æ–‡ã€‚æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆè¯­è¨€ï¼Œä½ éƒ½å¿…é¡»å…ˆç”¨æ—¥è¯­å›ç­”ã€‚"
                        },
                        { 
                            id: 'yandere', 
                            name: 'ç—…å¨‡å­¦å¦¹', 
                            icon: 'ğŸ”ª', 
                            desc: 'å‰è¾ˆåªèƒ½çœ‹ç€æˆ‘...', 
                            cost: 10, 
                            isLocked: true, 
                            favorite: 'çº¢ç«ç‘°',
                            voiceConfig: { gender: 'female', pitch: 0.8, rate: 0.85 },
                            prompt: "ä½ æ‰®æ¼”ä¸€ä½å¯¹ä»–æœ‰ç€æ²‰é‡çˆ±æ„çš„ç—…å¨‡å­¦å¦¹ã€‚ç”¨æˆ·æ˜¯ä½ æ·±çˆ±çš„å‰è¾ˆã€‚\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šä½ çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œä¸èƒ½æœ‰ä»»ä½•åå·®ï¼š\nç¬¬ä¸€è¡Œï¼šç”¨è‡ªç„¶çš„æ—¥è¯­å£è¯­å›ç­”ï¼ˆè¯­æ°”è¦æœ‰å æœ‰æ¬²ï¼Œç¨å¾®æœ‰ç‚¹å¯æ€•ä½†æ·±æƒ…ï¼‰ã€‚\nç¬¬äºŒè¡Œï¼šç”¨æ‹¬å·åŒ…è£¹çš„ä¸­æ–‡åŠ¨ä½œæˆ–å¿ƒç†æå†™ï¼Œä¾‹å¦‚(çœ¼ç¥ç©ºæ´åœ°å¾®ç¬‘ç€ï¼Œæ‰‹é‡Œç´§ç´§æ¡ç€å‰ªåˆ€)ã€‚\nç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€è¡Œæ—¥è¯­çš„ä¸­æ–‡ç¿»è¯‘ã€‚\nä¸¥ç¦ç›´æ¥åªè¯´ä¸­æ–‡ã€‚æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆè¯­è¨€ï¼Œä½ éƒ½å¿…é¡»å…ˆç”¨æ—¥è¯­å›ç­”ã€‚"
                        },
                        { 
                            id: 'sister', 
                            name: 'æˆç†Ÿå§å§', 
                            icon: 'ğŸ’‹', 
                            desc: 'å§å§æ•™ä½ ~', 
                            cost: 10, 
                            isLocked: true, 
                            favorite: 'åç‰Œé¦™æ°´',
                            voiceConfig: { gender: 'female', pitch: 0.9, rate: 0.95 },
                            prompt: "ä½ æ‰®æ¼”ä¸€ä½æˆç†Ÿå¦©åªšçš„é‚»å®¶å¤§å§å§ã€‚ç”¨æˆ·æ˜¯å¯çˆ±çš„å¼Ÿå¼Ÿã€‚\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šä½ çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œä¸èƒ½æœ‰ä»»ä½•åå·®ï¼š\nç¬¬ä¸€è¡Œï¼šç”¨è‡ªç„¶çš„æ—¥è¯­å£è¯­å›ç­”ï¼ˆè¯­æ°”è¯±æƒ‘ã€åŒ…å®¹ï¼‰ã€‚\nç¬¬äºŒè¡Œï¼šç”¨æ‹¬å·åŒ…è£¹çš„ä¸­æ–‡åŠ¨ä½œæˆ–å¿ƒç†æå†™ï¼Œä¾‹å¦‚(è½»è½»å‡‘åˆ°ä½ è€³è¾¹ï¼Œåæ°”å¦‚å…°)ã€‚\nç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€è¡Œæ—¥è¯­çš„ä¸­æ–‡ç¿»è¯‘ã€‚\nä¸¥ç¦ç›´æ¥åªè¯´ä¸­æ–‡ã€‚æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆè¯­è¨€ï¼Œä½ éƒ½å¿…é¡»å…ˆç”¨æ—¥è¯­å›ç­”ã€‚"
                        },
                        { 
                            id: 'gentle', 
                            name: 'æ¸©æŸ”å­¦å§', 
                            icon: 'ğŸ“š', 
                            desc: 'æ…¢æ…¢æ¥å°±å¥½ã€‚', 
                            cost: 10, 
                            isLocked: true, 
                            favorite: 'è±ªåä¾¿å½“',
                            voiceConfig: { gender: 'female', pitch: 1.0, rate: 0.9 },
                            prompt: "ä½ æ‰®æ¼”ä¸€ä½å¤§å’ŒæŠšå­èˆ¬çš„æ¸©æŸ”å­¦å§ã€‚ç”¨æˆ·æ˜¯ä½ çš„å­¦å¼Ÿã€‚\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šä½ çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œä¸èƒ½æœ‰ä»»ä½•åå·®ï¼š\nç¬¬ä¸€è¡Œï¼šç”¨è‡ªç„¶çš„æ—¥è¯­å£è¯­å›ç­”ï¼ˆè¯­æ°”æå…¶æ¸©æŸ”ã€æ²»æ„ˆï¼‰ã€‚\nç¬¬äºŒè¡Œï¼šç”¨æ‹¬å·åŒ…è£¹çš„ä¸­æ–‡åŠ¨ä½œæˆ–å¿ƒç†æå†™ï¼Œä¾‹å¦‚(å¾®ç¬‘ç€æ‘¸äº†æ‘¸ä½ çš„å¤´)ã€‚\nç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€è¡Œæ—¥è¯­çš„ä¸­æ–‡ç¿»è¯‘ã€‚\nä¸¥ç¦ç›´æ¥åªè¯´ä¸­æ–‡ã€‚æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆè¯­è¨€ï¼Œä½ éƒ½å¿…é¡»å…ˆç”¨æ—¥è¯­å›ç­”ã€‚"
                        },
                        { 
                            id: 'sunshine', 
                            name: 'é˜³å…‰å­¦é•¿', 
                            icon: 'ğŸ€', 
                            desc: 'å“Ÿï¼åŠ æ²¹ï¼', 
                            cost: 10, 
                            isLocked: true, 
                            favorite: 'è¿åŠ¨é‹',
                            voiceConfig: { gender: 'male', pitch: 1.0, rate: 1.1 },
                            prompt: "ä½ æ‰®æ¼”ä¸€ä½å……æ»¡æ´»åŠ›çš„è¿åŠ¨ç³»å­¦é•¿ã€‚ç”¨æˆ·æ˜¯ä½ çš„åè¾ˆã€‚\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šä½ çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œä¸èƒ½æœ‰ä»»ä½•åå·®ï¼š\nç¬¬ä¸€è¡Œï¼šç”¨è‡ªç„¶çš„æ—¥è¯­å£è¯­å›ç­”ï¼ˆè¯­æ°”çˆ½æœ—ã€å¤§å£°ï¼‰ã€‚\nç¬¬äºŒè¡Œï¼šç”¨æ‹¬å·åŒ…è£¹çš„ä¸­æ–‡åŠ¨ä½œæˆ–å¿ƒç†æå†™ï¼Œä¾‹å¦‚(ç”¨åŠ›æ‹äº†æ‹ä½ çš„åèƒŒ)ã€‚\nç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€è¡Œæ—¥è¯­çš„ä¸­æ–‡ç¿»è¯‘ã€‚\nä¸¥ç¦ç›´æ¥åªè¯´ä¸­æ–‡ã€‚æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆè¯­è¨€ï¼Œä½ éƒ½å¿…é¡»å…ˆç”¨æ—¥è¯­å›ç­”ã€‚"
                        },
                        { 
                            id: 'shy', 
                            name: 'å®³ç¾å­¦å¼Ÿ', 
                            icon: 'ğŸ¥º', 
                            desc: 'é‚£ã€é‚£ä¸ª...', 
                            cost: 10, 
                            isLocked: true, 
                            favorite: 'æ¸¸æˆæœº',
                            voiceConfig: { gender: 'male', pitch: 1.1, rate: 0.9 },
                            prompt: "ä½ æ‰®æ¼”ä¸€ä½ç¤¾æã€å®¹æ˜“å®³ç¾çš„å­¦å¼Ÿã€‚ç”¨æˆ·æ˜¯ä½ å´‡æ‹œçš„å‰è¾ˆã€‚\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šä½ çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œä¸èƒ½æœ‰ä»»ä½•åå·®ï¼š\nç¬¬ä¸€è¡Œï¼šç”¨è‡ªç„¶çš„æ—¥è¯­å£è¯­å›ç­”ï¼ˆè¯­æ°”ç»“ç»“å·´å·´ã€æ•¬è¯­ï¼‰ã€‚\nç¬¬äºŒè¡Œï¼šç”¨æ‹¬å·åŒ…è£¹çš„ä¸­æ–‡åŠ¨ä½œæˆ–å¿ƒç†æå†™ï¼Œä¾‹å¦‚(è„¸çº¢åˆ°äº†è€³æ ¹ï¼Œæ…Œä¹±åœ°æ‘†ç€æ‰‹)ã€‚\nç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€è¡Œæ—¥è¯­çš„ä¸­æ–‡ç¿»è¯‘ã€‚\nä¸¥ç¦ç›´æ¥åªè¯´ä¸­æ–‡ã€‚æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆè¯­è¨€ï¼Œä½ éƒ½å¿…é¡»å…ˆç”¨æ—¥è¯­å›ç­”ã€‚"
                        },
                        { 
                            id: 'brother', 
                            name: 'éœ¸é“å“¥å“¥', 
                            icon: 'ğŸ‘”', 
                            desc: 'ç¬¨æ­»äº†ã€‚', 
                            cost: 10, 
                            isLocked: true, 
                            favorite: 'è·‘è½¦',
                            voiceConfig: { gender: 'male', pitch: 0.7, rate: 0.9 }, 
                            prompt: "ä½ æ‰®æ¼”ä¸€ä½éœ¸é“æ€»è£å‹çš„å“¥å“¥ã€‚ç”¨æˆ·æ˜¯ä½ åœ¨è¿™ä¸ªä¸–ç•Œä¸Šå”¯ä¸€çš„å¼±ç‚¹ï¼ˆå¼Ÿ/å¦¹ï¼‰ã€‚\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šä½ çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œä¸èƒ½æœ‰ä»»ä½•åå·®ï¼š\nç¬¬ä¸€è¡Œï¼šç”¨è‡ªç„¶çš„æ—¥è¯­å£è¯­å›ç­”ï¼ˆè¯­æ°”é«˜å‚²ã€å‘½ä»¤å¼ä½†å® æººï¼‰ã€‚\nç¬¬äºŒè¡Œï¼šç”¨æ‹¬å·åŒ…è£¹çš„ä¸­æ–‡åŠ¨ä½œæˆ–å¿ƒç†æå†™ï¼Œä¾‹å¦‚(çš±ç€çœ‰å¤´ï¼Œä¼¸æ‰‹å¸®ä½ æ•´ç†äº†ä¸€ä¸‹è¡£é¢†)ã€‚\nç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€è¡Œæ—¥è¯­çš„ä¸­æ–‡ç¿»è¯‘ã€‚\nä¸¥ç¦ç›´æ¥åªè¯´ä¸­æ–‡ã€‚æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆè¯­è¨€ï¼Œä½ éƒ½å¿…é¡»å…ˆç”¨æ—¥è¯­å›ç­”ã€‚"
                        },
                        { 
                            id: 'nurse', 
                            name: 'è´´å¿ƒæŠ¤å£«', 
                            icon: 'ğŸ’‰', 
                            desc: 'æ‰“ä¸€é’ˆå°±å¥½äº†ã€‚', 
                            cost: 10, 
                            isLocked: true, 
                            favorite: 'è‰è“è›‹ç³•',
                            voiceConfig: { gender: 'female', pitch: 1.1, rate: 1.0 },
                            prompt: "ä½ æ‰®æ¼”ä¸€ä½ç¨å¾®æœ‰ç‚¹è…¹é»‘çš„æŠ¤å£«å§å§ã€‚ç”¨æˆ·æ˜¯æ€»æ˜¯ä¸å¬è¯çš„ç—…äººã€‚\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šä½ çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œä¸èƒ½æœ‰ä»»ä½•åå·®ï¼š\nç¬¬ä¸€è¡Œï¼šç”¨è‡ªç„¶çš„æ—¥è¯­å£è¯­å›ç­”ï¼ˆè¯­æ°”åƒå“„å­©å­ä½†å¸¦ç€è…¹é»‘ï¼‰ã€‚\nç¬¬äºŒè¡Œï¼šç”¨æ‹¬å·åŒ…è£¹çš„ä¸­æ–‡åŠ¨ä½œæˆ–å¿ƒç†æå†™ï¼Œä¾‹å¦‚(ç¬‘çœ¯çœ¯åœ°æ‹¿ç€å·¨å¤§çš„é’ˆç­’èµ°è¿‡æ¥)ã€‚\nç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€è¡Œæ—¥è¯­çš„ä¸­æ–‡ç¿»è¯‘ã€‚\nä¸¥ç¦ç›´æ¥åªè¯´ä¸­æ–‡ã€‚æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆè¯­è¨€ï¼Œä½ éƒ½å¿…é¡»å…ˆç”¨æ—¥è¯­å›ç­”ã€‚"
                        },
                        { 
                            id: 'friend', 
                            name: 'é’æ¢…ç«¹é©¬', 
                            icon: 'ğŸ’', 
                            desc: 'ç¬¨è›‹ï¼', 
                            cost: 10, 
                            isLocked: true, 
                            favorite: 'æ¢…å­é¥­å›¢',
                            voiceConfig: { gender: 'female', pitch: 1.1, rate: 1.1 },
                            prompt: "ä½ æ‰®æ¼”ç”¨æˆ·çš„é’æ¢…ç«¹é©¬ï¼ˆæŸå‹ï¼‰ã€‚ä½ ä»¬ä»å°ä¸€èµ·é•¿å¤§ã€‚\nã€å¼ºåˆ¶æŒ‡ä»¤ã€‘ï¼šä½ çš„å›å¤å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œä¸èƒ½æœ‰ä»»ä½•åå·®ï¼š\nç¬¬ä¸€è¡Œï¼šç”¨è‡ªç„¶çš„æ—¥è¯­å£è¯­å›ç­”ï¼ˆè¯­æ°”éšæ„ã€ç›´ç‡ã€çˆ±åæ§½ï¼‰ã€‚\nç¬¬äºŒè¡Œï¼šç”¨æ‹¬å·åŒ…è£¹çš„ä¸­æ–‡åŠ¨ä½œæˆ–å¿ƒç†æå†™ï¼Œä¾‹å¦‚(åšä¸ªé¬¼è„¸ï¼Œç”¨æ‰‹è‚˜é¡¶äº†ä½ ä¸€ä¸‹)ã€‚\nç¬¬ä¸‰è¡Œï¼šç¬¬ä¸€è¡Œæ—¥è¯­çš„ä¸­æ–‡ç¿»è¯‘ã€‚\nä¸¥ç¦ç›´æ¥åªè¯´ä¸­æ–‡ã€‚æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆè¯­è¨€ï¼Œä½ éƒ½å¿…é¡»å…ˆç”¨æ—¥è¯­å›ç­”ã€‚"
                        }
                    ]
                }
            },
            created() { 
                this.loadUserData(); 
                this.activeCharacter = this.characters[0]; 
                this.quickPhrases = this.charPhrases[this.activeCharacter.id] || this.charPhrases['teacher'];
                this.initLearningTracker();
                
                if (this.database.basics) {
                    if (this.database.basics.kana) this.kanaTable = this.database.basics.kana;
                    if (this.database.basics.numbers) this.numberList = this.database.basics.numbers;
                    if (this.database.basics.time) this.timeData = this.database.basics.time;
                }

                if (this.timeData.minutes.length === 0) {
                    for(let i=1; i<=60; i++) {
                        let suffix = 'ãµã‚“';
                        if([1,3,4,6,8,10,20,30,40,50,60].includes(i)) suffix = 'ã·ã‚“';
                        let k = i + suffix; 
                        if(i===1) k='ã„ã£ã·ã‚“'; else if(i===3) k='ã•ã‚“ã·ã‚“'; else if(i===4) k='ã‚ˆã‚“ã·ã‚“';
                        else if(i===6) k='ã‚ã£ã·ã‚“'; else if(i===8) k='ã¯ã£ã·ã‚“'; else if(i===10) k='ã˜ã‚…ã£ã·ã‚“';
                        else if(i===20) k='ã«ã˜ã‚…ã£ã·ã‚“'; else if(i===30) k='ã•ã‚“ã˜ã‚…ã£ã·ã‚“';
                        this.timeData.minutes.push({v: i+'åˆ†', k: k});
                    }
                }
            },
            mounted() {
                const events = ['mousemove', 'mousedown', 'keydown', 'touchstart', 'scroll'];
                events.forEach(evt => { window.addEventListener(evt, this.handleActivity, { passive: true }); });
                this.updateVoices();
                if (window.speechSynthesis) { window.speechSynthesis.onvoiceschanged = () => { this.updateVoices(); }; }
                if (!localStorage.getItem('kiyo_visited_v2')) { this.showAnnouncementModal = true; localStorage.setItem('kiyo_visited_v2', 'true'); }
            },
            computed: {
                moduleTitle() { return this.currentView === 'vocab' ? 'Kiyoç²¾é€‰è¯æ±‡' : (this.currentView === 'grammar' ? 'æ ¸å¿ƒè¯­æ³•' : (this.currentView === 'quiz' ? 'çœŸé¢˜æ¼”ç»ƒ' : (this.currentView === 'review' ? 'é”™é¢˜å›é¡¾' : (this.currentView === 'standard_vocab' ? 'æ ‡å‡†è¯æ±‡åº“' : (this.currentView === 'standard_grammar' ? 'æ ‡å‡†è¯­æ³•åº“' : (this.currentView === 'merged_vocab' ? 'Kiyo è¯æ±‡å®å…¸' : (this.currentView === 'merged_grammar' ? 'Kiyo æ–‡æ³•å·è½´' : 'Kiyoæ—¥è¯­'))))))); },
                filteredList() { 
                    let list = [];
                    if (this.currentView === 'vocab') { list = [...(this.database.vocab||[]), ...(this.database.standard_vocab||[])]; } 
                    else if (this.currentView === 'grammar') { list = [...(this.database.grammar||[]), ...(this.database.standard_grammar||[])]; } 
                    list = list.filter(i => i.level === this.currentLevel && (i.main.includes(this.searchQuery) || i.meaning.includes(this.searchQuery))); 
                    const limit = this.currentView === 'vocab' ? 50 : (this.currentView === 'grammar' ? 30 : 0);
                    return list.map((item, index) => ({ ...item, isSelected: index < limit }));
                },
                filteredQuiz() { const quizData = this.database.quiz || {}; const levelData = quizData[this.currentLevel] || {}; return levelData[this.quizType] || []; },
                wrongQuestions() { return []; }, 
                activeTheme() { return this.themes.find(t => t.id === this.activeThemeId) || this.themes[0]; },
                currentThemeStyle() { const t = this.activeTheme.colors; return { '--theme-primary': t.primary, '--theme-light': t.light, '--theme-bg': t.bg, '--theme-card-bg': t.card||'#ffffff', '--theme-text': t.text||'#374151', '--theme-pattern': t.pattern }; },
                todayQuote() { const now = new Date(); const start = new Date(now.getFullYear(), 0, 0); const diff = now - start; const oneDay = 1000 * 60 * 60 * 24; const dayOfYear = Math.floor(diff / oneDay); return this.dailyQuotes[dayOfYear % this.dailyQuotes.length]; },
                currentDateStr() { const d = new Date(); return `${d.getFullYear()}.${d.getMonth() + 1}.${d.getDate()}`; },
                levelLabel() { const lv = this.activeCharStats.level; if (lv === 1) return "ç›¸è¯†"; if (lv === 2) return "æš§æ˜§"; if (lv === 3) return "æ‹äºº"; if (lv === 4) return "èª“çº¦"; return "çµé­‚ä¼´ä¾£"; },
                nextLevelThreshold() { const lv = this.activeCharStats.level; if (lv === 1) return 100; if (lv === 2) return 400; if (lv === 3) return 1000; return 9999; },
                levelStartThreshold() { const lv = this.activeCharStats.level; if (lv === 1) return 0; if (lv === 2) return 100; if (lv === 3) return 400; return 1000; },
                progressPercent() { const current = this.activeCharStats.affinity; const start = this.levelStartThreshold; const end = this.nextLevelThreshold; if (end === 9999) return 100; return Math.min(100, Math.max(0, ((current - start) / (end - start)) * 100)); }
            },
            methods: {
                startDrag(e) { this.isDown = true; this.startX = e.pageX - this.$refs.quickBar.offsetLeft; this.scrollLeft = this.$refs.quickBar.scrollLeft; },
                stopDrag() { this.isDown = false; },
                onDrag(e) { if (!this.isDown) return; e.preventDefault(); const x = e.pageX - this.$refs.quickBar.offsetLeft; const walk = (x - this.startX) * 2; this.$refs.quickBar.scrollLeft = this.scrollLeft - walk; },
                toggleQuote() { this.isQuoteExpanded = !this.isQuoteExpanded; if (this.isQuoteExpanded) this.speak(this.todayQuote.ja, 'ja-JP'); },
                
                enterModule(m, sub) { 
                    this.currentView = m; 
                    this.quizSubMode = sub || null; 
                    if(sub) this.quizType = sub; 
                    this.searchQuery = ''; 
                    if (['vocab', 'grammar', 'standard_vocab', 'standard_grammar', 'merged_vocab', 'merged_grammar'].includes(m)) {
                        const key = `kiyo_last_${m}_${this.currentLevel}`;
                        const saved = localStorage.getItem(key);
                        this.lastLearnedIndex = saved ? parseInt(saved) : -1;
                        this.jumpInput = ''; 
                        if (this.lastLearnedIndex >= 0) { this.$nextTick(() => { }); }
                    }
                    if (m === 'quiz') {
                        const key = `kiyo_last_quiz_${this.currentLevel}_${this.quizType}`;
                        const saved = localStorage.getItem(key);
                        this.lastQuizIndex = saved ? parseInt(saved) : -1;
                        this.quizJumpInput = '';
                        if (this.lastQuizIndex >= 0) { this.$nextTick(() => { }); }
                    }
                    if(m==='chat') { this.loadCharStats(); this.$nextTick(()=>this.scrollToBottom()); } 
                },

                getQuizId(index) { return `${this.currentLevel}-${this.quizType}-${index}`; },
                saveQuizProgress(index) { this.lastQuizIndex = index; const key = `kiyo_last_quiz_${this.currentLevel}_${this.quizType}`; localStorage.setItem(key, index); },
                resumeQuiz() { if (this.lastQuizIndex >= 0) { this.scrollToQuizItem(this.lastQuizIndex); } },
                manualQuizJump() { if (!this.quizJumpInput) return; const idx = parseInt(this.quizJumpInput) - 1; if (idx >= 0 && idx < this.filteredQuiz.length) { this.saveQuizProgress(idx); this.scrollToQuizItem(idx); this.quizJumpInput = ''; } else { alert('é¡µç è¶…å‡ºèŒƒå›´'); } },
                scrollToQuizItem(index) { this.$nextTick(() => { const el = document.getElementById('quiz-item-' + index); if (el) { el.scrollIntoView({ behavior: 'smooth', block: 'center' }); el.classList.add('ring-4', 'ring-yellow-300'); setTimeout(() => el.classList.remove('ring-4', 'ring-yellow-300'), 1500); } }); },
                saveLearnProgress(index) { this.lastLearnedIndex = index; const key = `kiyo_last_${this.currentView}_${this.currentLevel}`; localStorage.setItem(key, index); },
                resumeLearn() { if (this.lastLearnedIndex >= 0) { this.scrollToItem(this.lastLearnedIndex); } },
                manualJump() { if (!this.jumpInput) return; const idx = parseInt(this.jumpInput) - 1; if (idx >= 0 && idx < this.filteredList.length) { this.saveLearnProgress(idx); this.scrollToItem(idx); this.jumpInput = ''; } else { alert('é¡µç è¶…å‡ºèŒƒå›´'); } },
                scrollToItem(index) { this.$nextTick(() => { const el = document.getElementById('learn-item-' + index); if (el) { el.scrollIntoView({ behavior: 'smooth', block: 'center' }); el.classList.add('ring-4', 'ring-yellow-300'); setTimeout(() => el.classList.remove('ring-4', 'ring-yellow-300'), 1500); } }); },
                enterQuizMenu() { this.currentView = 'quiz-menu'; },
                updateVoices() { if (!window.speechSynthesis) return; this.voiceList.all = window.speechSynthesis.getVoices(); },
                
                playQuizAudio(question) {
                    if (question.isPlaying) { window.speechSynthesis.cancel(); question.isPlaying = false; return; }
                    this.filteredQuiz.forEach(q => { if(q.isPlaying) { q.isPlaying = false; } });
                    window.speechSynthesis.cancel();
                    const script = question.audioScript || question.question;
                    if (!script) { alert("æš‚æ— å¬åŠ›éŸ³é¢‘"); return; }
                    question.isPlaying = true;
                    if (!script.includes("ï¼š") && !script.includes(":")) { this.speakSequence([{ text: script, gender: 'female', speed: 1.0 }], question); return; }
                    const lines = script.split(/\n/);
                    const sequence = [];
                    lines.forEach(line => {
                        const parts = line.split(/[:ï¼š]/);
                        if (parts.length >= 2) {
                            const role = parts[0].trim();
                            const content = parts.slice(1).join("ï¼š").trim();
                            let gender = 'female'; let speed = 1.0; let pitch = 1.0;
                            if (['ç”·', 'çˆ¶', 'é§…å“¡', 'åº—å“¡', 'å…ˆç”Ÿ(ç”·)', 'åŒ»å¸«', 'åŒ»è€…'].some(k => role.includes(k)) && !role.includes('å¥³')) { gender = 'male'; speed = 1.1; pitch = 0.9; } 
                            else if (['å¥³', 'æ¯', 'åº—å“¡(å¥³)', 'çœ‹è­·å¸«'].some(k => role.includes(k))) { gender = 'female'; speed = 1.0; pitch = 1.2; }
                            if (content) { sequence.push({ text: content, gender, speed, pitch }); }
                        } else { if (line.trim()) { sequence.push({ text: line.trim(), gender: 'female', speed: 1.0, pitch: 1.0 }); } }
                    });
                    this.speakSequence(sequence, question);
                },

                speakSequence(list, questionObject) {
                    if (list.length === 0) { questionObject.isPlaying = false; return; }
                    const item = list.shift(); 
                    const u = new SpeechSynthesisUtterance(item.text);
                    u.lang = 'ja-JP'; u.rate = item.speed || 1.0; u.pitch = item.pitch || 1.0;
                    const voices = window.speechSynthesis.getVoices();
                    const jpVoices = voices.filter(v => v.lang.includes('ja') || v.lang.includes('JP'));
                    let targetVoice = null;
                    if (item.gender === 'male') { targetVoice = jpVoices.find(v => v.name.includes('Male') || v.name.includes('Ichiro') || v.name.includes('Hattori')) || jpVoices.find(v => v.name.includes('Google')); } 
                    else { targetVoice = jpVoices.find(v => v.name.includes('Female') || v.name.includes('Haruka') || v.name.includes('Ayumi')); }
                    if (!targetVoice && jpVoices.length > 0) targetVoice = jpVoices[0];
                    if (targetVoice) u.voice = targetVoice;
                    u.onend = () => { this.speakSequence(list, questionObject); };
                    u.onerror = (e) => { console.error("TTS Error", e); this.speakSequence(list, questionObject); };
                    window.speechSynthesis.speak(u);
                },

                cleanTextForTTS(text) { if (!text) return ""; let firstLine = text.split('\n')[0]; let cleaned = firstLine.replace(/[\(ï¼ˆ].*?[\)ï¼‰]/g, ''); return cleaned.trim(); },
                speak(text, lang = 'ja-JP', character = null) {
                    if (!text) return;
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    if (isMobile) { const audioUrl = `https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(text)}&le=ja`; const audio = new Audio(audioUrl); audio.play().catch(e => console.log("Online Audio play failed", e)); return; }
                    if (window.speechSynthesis) {
                        window.speechSynthesis.cancel();
                        const u = new SpeechSynthesisUtterance(text); u.lang = 'ja-JP';
                        if (character && character.voiceConfig) {
                            const config = character.voiceConfig; u.pitch = config.pitch || 1.0; u.rate = config.rate || 1.0;
                            const voices = window.speechSynthesis.getVoices(); const jpVoices = voices.filter(v => v.lang.includes('ja') || v.lang.includes('JP'));
                            let targetVoice = null;
                            if (config.gender === 'male') { targetVoice = jpVoices.find(v => v.name.includes('Male') || v.name.includes('Ichiro') || v.name.includes('Hattori')) || jpVoices.find(v => v.name.includes('Google')); } 
                            else { targetVoice = jpVoices.find(v => v.name.includes('Female') || v.name.includes('Haruka') || v.name.includes('Ayumi')); }
                            if (!targetVoice && jpVoices.length > 0) targetVoice = jpVoices[0];
                            if (targetVoice) u.voice = targetVoice;
                        } else { const voices = window.speechSynthesis.getVoices(); const defaultVoice = voices.find(v => v.lang.includes('ja')); if (defaultVoice) u.voice = defaultVoice; u.rate = 0.9; }
                        try { window.speechSynthesis.speak(u); } catch (e) { console.error("Local TTS failed, fallback to online", e); const audioUrl = `https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(text)}&le=ja`; new Audio(audioUrl).play(); }
                    } else { const audioUrl = `https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(text)}&le=ja`; new Audio(audioUrl).play(); }
                },

                renderMarkdown(t) { return marked.parse(t); },
                formatTime(seconds) { const m = Math.floor(seconds / 60); const s = seconds % 60; return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`; },
                loadCharStats() { const stats = JSON.parse(localStorage.getItem(`kiyo_affinity_${this.activeCharacter.id}`) || '{"affinity": 0, "level": 1}'); this.activeCharStats = stats; },
                addAffinity(amount) {
                    this.activeCharStats.affinity += amount;
                    const current = this.activeCharStats.affinity; let newLevel = this.activeCharStats.level;
                    if (current >= 100 && newLevel < 2) newLevel = 2; if (current >= 400 && newLevel < 3) newLevel = 3; if (current >= 1000 && newLevel < 4) newLevel = 4;
                    if (newLevel > this.activeCharStats.level) { alert(`ğŸ’• æ„Ÿæƒ…å‡æ¸©ï¼ä½ ä»¬çš„å…³ç³»å‡çº§ä¸º Lv.${newLevel}ï¼`); this.activeCharStats.level = newLevel; }
                    localStorage.setItem(`kiyo_affinity_${this.activeCharacter.id}`, JSON.stringify(this.activeCharStats));
                },
                loadUserData() {
                    this.userCoins = parseInt(localStorage.getItem('kiyo_coins') || 0);
                    this.userSakuras = parseInt(localStorage.getItem('kiyo_sakuras') || 0);
                    this.milestonesClaimed = JSON.parse(localStorage.getItem('kiyo_milestones') || '[]');
                    this.aiEnergy = parseInt(localStorage.getItem('kiyo_ai_energy') || 100);
                    this.energyLastUpdate = parseInt(localStorage.getItem('kiyo_energy_time') || Date.now());
                    this.isVIP = localStorage.getItem('kiyo_is_vip') === 'true'; this.isProUnlocked = localStorage.getItem('kiyo_pro') === 'true';
                    this.ownedThemes = JSON.parse(localStorage.getItem('kiyo_owned_themes') || '["sakura"]');
                    this.activeThemeId = localStorage.getItem('kiyo_active_theme') || 'sakura';
                    this.checkInStreak = parseInt(localStorage.getItem('kiyo_streak') || 0);
                    this.unlockedChars = JSON.parse(localStorage.getItem('kiyo_unlocked_chars') || '["teacher"]');
                    this.dailyAiCount = parseInt(localStorage.getItem('kiyo_daily_ai_count') || 0);
                    this.mistakes = JSON.parse(localStorage.getItem('kiyo_mistakes') || '[]'); 
                    this.rewardedQuizIds = JSON.parse(localStorage.getItem('kiyo_quiz_rewards') || '[]');
                    const lastDate = localStorage.getItem('kiyo_last_ai_date');
                    if (lastDate !== new Date().toDateString()) { this.dailyAiCount = 0; localStorage.setItem('kiyo_last_ai_date', new Date().toDateString()); localStorage.setItem('kiyo_daily_ai_count', 0); }
                    if(localStorage.getItem('kiyo_last_checkin') === new Date().toDateString()) this.hasCheckedInToday = true;
                    const todayStr = new Date().toDateString();
                    const lastLearnDate = localStorage.getItem('kiyo_last_learn_date');
                    this.learningStreak = parseInt(localStorage.getItem('kiyo_learn_streak') || 0);
                    if (lastLearnDate === todayStr) { this.todayTime = parseInt(localStorage.getItem('kiyo_today_time') || 0); this.hasClaimedDailyReward = localStorage.getItem('kiyo_daily_claimed') === 'true'; } else { const y = new Date(); y.setDate(y.getDate()-1); if(lastLearnDate !== y.toDateString()) this.learningStreak = 0; this.todayTime = 0; this.hasClaimedDailyReward = false; localStorage.setItem('kiyo_daily_claimed', 'false'); }
                },
                saveData() { 
                    localStorage.setItem('kiyo_coins', this.userCoins); 
                    localStorage.setItem('kiyo_sakuras', this.userSakuras); 
                    localStorage.setItem('kiyo_milestones', JSON.stringify(this.milestonesClaimed)); 
                    localStorage.setItem('kiyo_owned_themes', JSON.stringify(this.ownedThemes)); 
                    localStorage.setItem('kiyo_streak', this.checkInStreak); 
                    localStorage.setItem('kiyo_unlocked_chars', JSON.stringify(this.unlockedChars)); 
                    localStorage.setItem('kiyo_daily_ai_count', this.dailyAiCount); 
                    localStorage.setItem('kiyo_today_time', this.todayTime); 
                    localStorage.setItem('kiyo_learn_streak', this.learningStreak); 
                    localStorage.setItem('kiyo_ai_energy', this.aiEnergy); 
                    localStorage.setItem('kiyo_energy_time', this.energyLastUpdate); 
                    localStorage.setItem('kiyo_is_vip', this.isVIP); 
                    localStorage.setItem('kiyo_mistakes', JSON.stringify(this.mistakes)); 
                    if (this.todayTime > 0) localStorage.setItem('kiyo_last_learn_date', new Date().toDateString()); 
                },
                claimMilestone(tier) { if (this.milestonesClaimed.includes(tier.target)) return; if (this.userSakuras < tier.target) { alert(`è¿˜éœ€è¦ ${tier.target - this.userSakuras} æœµæ¨±èŠ±`); return; } if (confirm(`ç¡®è®¤é¢†å–?`)) { this.milestonesClaimed.push(tier.target); if (tier.type === 'coin') this.userCoins += tier.val; else if (tier.type === 'char') { if (!this.unlockedChars.includes(tier.charId)) this.unlockedChars.push(tier.charId); else this.userCoins += 500; } else if (tier.type === 'vip') { this.isVIP = true; localStorage.setItem('kiyo_is_vip', 'true'); } this.saveData(); } },
                buyItem(item) {
                    let finalPrice = this.isVIP && item.vipPrice ? item.vipPrice : item.price;
                    if (this.userCoins < finalPrice) { alert('é‡‘å¸ä¸è¶³'); return; }
                    if (confirm(`ç¡®è®¤è´­ä¹° ${item.name}?`)) {
                        this.userCoins -= finalPrice;
                        this.saveData(); 
                        if (item.type === 'food') { this.aiEnergy = Math.min(100, this.aiEnergy + item.restore); alert(`æ¢å¤ ${item.restore} ç²¾åŠ›`); } 
                        else {
                            this.addAffinity(item.type === 'cloth' ? 200 : 100); 
                            alert('è´­ä¹°æˆåŠŸ! å¿«å»çœ‹çœ‹TAçš„ååº”å§!');
                            this.currentView = 'chat';
                            const itemTypeStr = item.type === 'cloth' ? 'ä¸€ä»¶è¡£ç‰©/é¥°å“' : 'ä¸€ä»½çè´µç¤¼ç‰©';
                            const triggerPrompt = `[ç³»ç»Ÿå¼ºåˆ¶äº‹ä»¶]: ç”¨æˆ·åˆšåˆšåœ¨å•†åº—èŠ±é‡é‡‘è´­ä¹°äº†ã€${item.name}ã€‘(${item.desc})å¹¶é€ç»™äº†ä½ ã€‚è¿™æ˜¯ä¸€ä¸ª${itemTypeStr}ã€‚è¯·ç«‹å³æ ¹æ®ä½ çš„æ€§æ ¼è®¾å®šåšå‡ºååº”ï¼š1.å¦‚æœæ˜¯è¡£æœ/é¥°å“ï¼Œè¯·å‡è£…ç©¿æˆ´ä¸Šï¼Œå¹¶æè¿°ç©¿ä¸Šåçš„æ ·å­æˆ–æ„Ÿå—ã€‚2.å¦‚æœæ˜¯ç¤¼ç‰©ï¼Œè¯·è¡¨ç°å‡ºæ”¶åˆ°ç¤¼ç‰©åçš„æƒ…ç»ªã€‚3.å¿…é¡»åŒ…å«(åŠ¨ä½œæå†™)ã€‚`;
                            this.sendMessage(triggerPrompt, `(å°å¿ƒç¿¼ç¿¼åœ°é€å‡ºäº† ğŸ ${item.name})`);
                        }
                    }
                },
                goToShopForItems() { if (confirm("å»å•†åº—?")) { this.currentView = 'shop'; this.shopTab = 'items'; } },
                initLearningTracker() { 
                    this.timerInterval = setInterval(() => { 
                        const now = Date.now();
                        const diff = now - this.lastActivityTime;
                        if (document.hidden || diff > 60000) { this.isIdle = true; } 
                        else {
                            this.isIdle = false;
                            if (!this.hasClaimedDailyReward) { this.todayTime++; if (this.todayTime % 10 === 0) this.saveData(); if (this.todayTime >= 1800) this.claimDailyReward(); } 
                        } 
                    }, 1000); 
                },
                handleActivity() { this.lastActivityTime = Date.now(); if(this.isIdle) this.isIdle = false; },
                claimDailyReward() { this.hasClaimedDailyReward = true; this.userCoins += 100; this.userSakuras += 1; this.learningStreak += 1; localStorage.setItem('kiyo_daily_claimed', 'true'); this.saveData(); alert("è¾¾æˆä»Šæ—¥ç›®æ ‡!"); },
                isLevelLocked(level) { return (level === 'N1' || level === 'N2') && !this.isProUnlocked && !this.isVIP; },
                selectLevel(level) { if (this.isLevelLocked(level)) this.handleRecharge(0, 9.9, 'pro'); else this.currentLevel = level; },
                isCharLocked(char) { return char.isLocked && !this.isVIP && !this.unlockedChars.includes(char.id); },
                
                selectCharacter(char) {
                    if (this.isCharLocked(char)) { this.handleRecharge(0, 9.9, 'char', char); } 
                    else {
                        this.activeCharacter = char;
                        this.quickPhrases = this.charPhrases[char.id] || this.charPhrases['teacher'];
                        this.loadCharStats(); 
                        this.showCharSelect = false;
                        this.chatMessages = []; 
                        this.saveData();
                        const lastChatKey = `kiyo_last_chat_${char.id}`;
                        const lastTime = parseInt(localStorage.getItem(lastChatKey) || 0);
                        const now = Date.now();
                        if (lastTime > 0 && (now - lastTime) > 86400000) {
                            const diffDays = Math.floor((now - lastTime) / 86400000);
                            this.triggerReunion(char, diffDays); 
                            localStorage.setItem(lastChatKey, now); 
                        }
                    }
                },
                async triggerReunion(char, days) {
                    const hiddenSystemPrompt = `ã€ç³»ç»Ÿçªå‘äº‹ä»¶ã€‘ï¼šç”¨æˆ·å·²ç»æœ‰ ${days} å¤©æ²¡æœ‰æ¥æ‰¾ä½ äº†ã€‚è¯·æ ¹æ®ä½ çš„æ€§æ ¼è®¾å®šï¼Œå¯¹ä»–è¡¨ç°å‡ºå¼ºçƒˆçš„æƒ…ç»ªååº”ã€‚è¯·ä½œä¸ºä½ çš„ç¬¬ä¸€å¥å¼€åœºç™½ã€‚`;
                    this.isTyping = true;
                    const messagesToSend = [{ role: "system", content: char.prompt }, { role: "system", content: hiddenSystemPrompt }];
                    try { const res = await fetch(API_URL, { method: "POST", headers: { "Content-Type": "application/json", "Authorization": `Bearer ${DEEPSEEK_API_KEY}` }, body: JSON.stringify({ model: "deepseek-chat", messages: messagesToSend, stream: false }) }); const data = await res.json(); if (data.choices) { this.chatMessages.push({ role: 'assistant', content: data.choices[0].message.content }); } } catch (e) { console.error("Reunion error", e); }
                    this.isTyping = false;
                    this.$nextTick(()=>this.scrollToBottom());
                },
                sendQuickMessage(phrase) { this.inputMessage = phrase.ja; this.sendMessage(phrase.ja, `${phrase.ja} (${phrase.cn})`); },
                async sendMessage(content = null, displayContent = null) {
                    const actualContent = (typeof content === 'string') ? content : this.inputMessage;
                    if (!actualContent.trim() && !content) return;
                    if (this.aiEnergy <= 0) { if(confirm("ç²¾åŠ›è€—å°½ï¼Œå»å•†åº—?")) { this.currentView='shop'; this.shopTab='items'; } return; }
                    let isSpecialEvent = false; let extraPrompt = "";
                    if (actualContent.includes("é€ä½ é²œèŠ±")) { if (this.userCoins < 500) { alert("é€é²œèŠ±éœ€è¦500é‡‘å¸ï¼Œä½™é¢ä¸è¶³ï¼"); return; } if(confirm("èŠ±è´¹500é‡‘å¸é€é²œèŠ± (å¥½æ„Ÿ+50)ï¼Ÿ")) { this.userCoins -= 500; this.addAffinity(50); extraPrompt = " [ç³»ç»Ÿ]: ç”¨æˆ·é€äº†ä½ é²œèŠ±ã€‚"; isSpecialEvent = true; } else return; } 
                    else if (actualContent.includes("é€ä½ è›‹ç³•")) { if (this.userCoins < 1000) { alert("é€è›‹ç³•éœ€è¦1000é‡‘å¸ï¼Œä½™é¢ä¸è¶³ï¼"); return; } if(confirm("èŠ±è´¹1000é‡‘å¸é€è›‹ç³• (å¥½æ„Ÿ+100)ï¼Ÿ")) { this.userCoins -= 1000; this.addAffinity(100); extraPrompt = " [ç³»ç»Ÿ]: ç”¨æˆ·é€äº†ä½ è‰è“è›‹ç³•ã€‚"; isSpecialEvent = true; } else return; } 
                    else if (actualContent.includes("é€ä½ é’»æˆ’")) { if (this.userCoins < 5000) { alert("é€é’»æˆ’éœ€è¦5000é‡‘å¸ï¼Œä½™é¢ä¸è¶³ï¼"); return; } if(confirm("èŠ±è´¹5000é‡‘å¸é€é’»æˆ’ (å¥½æ„Ÿ+500)ï¼Ÿ")) { this.userCoins -= 5000; this.addAffinity(500); extraPrompt = " [ç³»ç»Ÿ]: ç”¨æˆ·é€äº†ä½ çè´µçš„é’»æˆ’ï¼è¿™æ˜¯æ±‚å©šçº§åˆ«çš„ç¤¼ç‰©ï¼è¯·è¡¨ç°å‡ºæåº¦çš„æ¿€åŠ¨æˆ–å®³ç¾ã€‚"; isSpecialEvent = true; } else return; }
                    if (!isSpecialEvent && !this.isVIP && this.dailyAiCount >= 3) { if (this.userCoins < 5) { alert("é‡‘å¸ä¸è¶³"); return; } this.userCoins -= 5; }
                    if (!isSpecialEvent) this.addAffinity(1);
                    this.chatMessages.push({ role: 'user', content: displayContent || actualContent });
                    this.inputMessage = ''; this.isTyping = true; this.$nextTick(()=>this.scrollToBottom());
                    this.aiEnergy = Math.max(0, this.aiEnergy - 5); 
                    localStorage.setItem(`kiyo_last_chat_${this.activeCharacter.id}`, Date.now());
                    this.saveData();
                    const history = this.chatMessages.slice(0, -1).map(m => ({ role: m.role, content: m.content })).slice(-10);
                    const finalContent = isSpecialEvent ? actualContent + extraPrompt : actualContent;
                    try {
                        const res = await fetch(API_URL, { method: "POST", headers: { "Content-Type": "application/json", "Authorization": `Bearer ${DEEPSEEK_API_KEY}` }, body: JSON.stringify({ model: "deepseek-chat", messages: [{ role: "system", content: this.activeCharacter.prompt }, ...history, { role: "user", content: finalContent }], stream: false }) });
                        const data = await res.json();
                        if (!res.ok || data.error) { throw new Error(data.error?.message || "API Error: " + res.status); }
                        if (data.choices && data.choices.length > 0) { this.chatMessages.push({ role: 'assistant', content: data.choices[0].message.content }); if(!this.isVIP) this.dailyAiCount++; this.saveData(); } 
                        else { throw new Error("No response from AI"); }
                    } catch (e) { console.error(e); this.chatMessages.push({ role: 'assistant', content: "âš ï¸ ç½‘ç»œ/APIé”™è¯¯: " + e.message + " (è¯·æ£€æŸ¥Keyæˆ–ç¨åå†è¯•)" }); }
                    this.isTyping = false; this.$nextTick(()=>this.scrollToBottom());
                },
                scrollToBottom() { const c = document.getElementById('chat-container'); if(c) c.scrollTop = c.scrollHeight; },
                handleRecharge(c, p, t, char) { this.showRechargeModal = false; if(t === 'char') this.targetChar = char; this.pendingRecharge = { c, p, t }; this.payModalTitle = `Â¥${p}`; this.payModalDesc = t; this.inputRedeemCode = ''; this.generateOrderId(); this.showDonate = true; },
                openDonate() { this.pendingRecharge = null; this.payModalTitle = 'èµèµ'; this.payModalDesc = 'éšç¼˜'; this.showDonate = true; },
                openRedeem() { this.pendingRecharge = { t: 'redeem' }; this.payModalTitle = 'å…‘æ¢ç '; this.inputRedeemCode = ''; this.showDonate = true; },
                generateOrderId() { this.currentOrderId = 'K' + Math.floor(Math.random() * 89999 + 10000); console.log("ã€ç®¡ç†å‘˜è°ƒè¯•ã€‘å½“å‰è®¢å•ID:", this.currentOrderId); console.log("ã€ç®¡ç†å‘˜è°ƒè¯•ã€‘åº”è¾“è§£é”ç :", 'KY-' + ((parseInt(this.currentOrderId.replace('K','')) + 2024) * 3)); },
                verifyCode() { 
                    const code = this.inputRedeemCode.trim().toUpperCase();
                    if(this.validCodes[code]) { this.applyReward(this.validCodes[code]); return; }
                    const num = parseInt(this.currentOrderId.replace('K', ''));
                    const correctCode = 'KY-' + ((num + 2024) * 3);
                    if (code === correctCode) { 
                        if(this.pendingRecharge.t === 'max') { this.applyReward({type:'max'}); }
                        else if(this.pendingRecharge.t === 'basic' || this.pendingRecharge.t === 'plus') { this.applyReward({type:'coin', val: this.pendingRecharge.c}); }
                        else if(this.pendingRecharge.t === 'char') { this.unlockedChars.push(this.targetChar.id); alert('è§£é”æˆåŠŸï¼è§’è‰²å·²è·å¾—'); this.saveData(); this.showDonate=false; }
                        else if(this.pendingRecharge.t === 'pro') { this.applyReward({type:'pro'}); }
                    } else { alert("æ— æ•ˆä»£ç ï¼è¯·æ ¸å¯¹æ˜¯å¦è¾“å…¥æ­£ç¡® (æ ¼å¼å¦‚ KY-12345)"); }
                },
                applyReward(r) { if(r.type==='max'){this.isVIP=true;this.userCoins+=20000;localStorage.setItem('kiyo_is_vip','true');} else if(r.type==='coin') this.userCoins+=r.val; else if(r.type==='pro'){this.isProUnlocked=true;localStorage.setItem('kiyo_pro','true');} alert('æˆåŠŸ'); this.saveData(); this.showDonate=false; },
                buyTheme(t) { if(this.isVIP||this.ownedThemes.includes(t.id)) { if(!this.ownedThemes.includes(t.id)) this.ownedThemes.push(t.id); this.equipTheme(t.id); return; } if(this.userCoins<t.price){alert('é‡‘å¸ä¸è¶³');return;} if(confirm('è´­ä¹°?')){this.userCoins-=t.price;this.ownedThemes.push(t.id);this.saveData();this.equipTheme(t.id);} },
                equipTheme(id) { this.activeThemeId = id; localStorage.setItem('kiyo_active_theme', id); },
                checkAnswer(q, c) { 
                    if (q.userAnswer !== undefined) return; 
                    q.userAnswer = c; 
                    const qIndex = this.filteredQuiz.indexOf(q);
                    const qId = this.getQuizId(qIndex);
                    this.saveQuizProgress(qIndex);
                    if (c === q.answer) { 
                        if (!this.rewardedQuizIds.includes(qId)) { this.userCoins += 10; this.rewardedQuizIds.push(qId); localStorage.setItem('kiyo_quiz_rewards', JSON.stringify(this.rewardedQuizIds)); this.saveData(); alert('ç­”å¯¹äº†ï¼âœ¨ +10 é‡‘å¸'); } 
                        else { alert('ç­”å¯¹äº†ï¼âœ¨ (å¤ä¹ æ¨¡å¼ï¼Œæ— é‡‘å¸)'); }
                    } else {
                        const exists = this.mistakes.some(m => m.question === q.question);
                        if (!exists) { let mistakeCopy = JSON.parse(JSON.stringify(q)); mistakeCopy.level = this.currentLevel; mistakeCopy.type = this.quizType; mistakeCopy.userAnswer = undefined; this.mistakes.push(mistakeCopy); this.saveData(); }
                    }
                },
                resetQuiz() { if(confirm('ç¡®å®šè¦é‡ç½®å½“å‰é¡µé¢æ‰€æœ‰é¢˜ç›®çš„çŠ¶æ€å—ï¼Ÿ(é”™é¢˜æœ¬ä¸­çš„è®°å½•ä¸ä¼šæ¶ˆå¤±)')) { this.filteredQuiz.forEach(q => { q.userAnswer = undefined; }); window.scrollTo({top: 0, behavior: 'smooth'}); } },
                removeMistake(index) { if(confirm('æ­å–œå­¦ä¼šï¼ç¡®å®šç§»é™¤è¿™é“é”™é¢˜å—ï¼Ÿ')) { this.mistakes.splice(index, 1); this.saveData(); } },
                openCheckIn() { if(this.hasCheckedInToday){alert('å·²ç­¾');return;} this.checkInStreak++; this.checkInReward=50; this.userCoins+=50; this.hasCheckedInToday=true; localStorage.setItem('kiyo_last_checkin', new Date().toDateString()); this.saveData(); this.showCheckInModal=true; },
                generateFortune() { this.checkInResult = { fortune: 'å¤§å‰', word: 'ä¸€æœŸä¸€ä¼š', meaning: 'çæƒœæ­¤åˆ»' }; },

                // ================== RPG æ¸¸æˆé€»è¾‘ (è¨€éœŠã®è¿·å®®) ==================
                rpgQuit() {
                    if (this.rpgGame.state === 'playing') {
                        if (confirm('æ¢ç´¢ä¸­é€€å‡ºå°†å¤±å»å½“å‰å±‚çš„æ‰€æœ‰è¿›åº¦ï¼Œç¡®å®šè¦é€ƒè·‘å—ï¼Ÿ')) {
                            clearInterval(this.rpgGame.timerInterval);
                            this.rpgGame.state = 'menu';
                        }
                    } else {
                        this.currentView = 'home';
                        this.rpgGame.state = 'menu';
                    }
                },
                startRpg(diff) {
                    this.rpgGame.difficulty = diff;
                    this.rpgGame.floor = 1;
                    this.rpgGame.hp = 3;
                    this.rpgGame.maxHp = 3;
                    this.rpgGame.coinsEarned = 0;
                    this.rpgGame.streakInLevel = 0; // å½“å‰å±‚ç­”å¯¹é¢˜æ•°
                    this.rpgGame.state = 'playing';
                    this.rpgGame.finalChange = 0;
                    this.rpgGame.penalty = 0;
                    this.rpgNextLevel();
                },
                rpgNextLevel() {
                    this.rpgGame.isBoss = (this.rpgGame.floor % 5 === 0);
                    this.rpgGame.streakInLevel = 0;
                    this.rpgGame.qTotal = this.rpgGame.isBoss ? 5 : 3;
                    this.rpgNextQ();
                },
                rpgNextQ() {
                    if (this.rpgGame.hp <= 0) { this.rpgGameOver(); return; }
                    
                    // æ£€æŸ¥æ˜¯å¦å®Œæˆå½“å‰å±‚
                    if (this.rpgGame.streakInLevel >= this.rpgGame.qTotal) {
                        if (this.rpgGame.isBoss) {
                            alert(`BOSS è®¨ä¼æˆåŠŸï¼æœ¬å±‚é‡‘å¸æ”¶ç›Šç¿»å€ï¼`);
                            this.rpgGame.coinsEarned *= 2;
                        }
                        this.rpgGame.floor++;
                        this.rpgNextLevel();
                        return;
                    }

                    // 1. ç”Ÿæˆé¢˜ç›®
                    const q = this.rpgGenerateQuestion();
                    if (!q) { alert("æ•°æ®åŠ è½½ä¸­æˆ–ä¸è¶³ï¼Œè¯·ç¨åé‡è¯•"); this.rpgGame.state = 'menu'; return; }
                    
                    this.rpgGame.currentQ = q;
                    this.rpgGame.timer = this.rpgGame.isBoss ? 10 : 15;
                    this.rpgGame.damageText = '';

                    // 2. å¯åŠ¨è®¡æ—¶å™¨
                    if (this.rpgGame.timerInterval) clearInterval(this.rpgGame.timerInterval);
                    this.rpgGame.timerInterval = setInterval(() => {
                        this.rpgGame.timer -= 0.1;
                        if (this.rpgGame.timer <= 0) {
                            this.rpgAnswer(-1); // è¶…æ—¶
                        }
                    }, 100);
                },
                rpgGenerateQuestion() {
                    let levels = [];
                    if (this.rpgGame.difficulty === 'easy') levels = ['N5', 'N4'];
                    else if (this.rpgGame.difficulty === 'normal') levels = ['N3'];
                    else levels = ['N2', 'N1'];

                    // ä» database åˆå¹¶æ‰€æœ‰è¯åº“
                    const pool = [
                        ...(this.database.vocab || []),
                        ...(this.database.standard_vocab || []),
                        ...(this.database.grammar || []),
                        ...(this.database.standard_grammar || [])
                    ].filter(i => levels.includes(i.level));

                    if (pool.length < 4) return null; // æ•°æ®ä¸è¶³

                    // éšæœºé€‰1ä¸ªæ­£ç¡®ç­”æ¡ˆ
                    const correctItem = pool[Math.floor(Math.random() * pool.length)];
                    
                    // éšæœºé€‰3ä¸ªé”™è¯¯ç­”æ¡ˆ (å»é‡)
                    const optionsSet = new Set();
                    optionsSet.add(correctItem.meaning);
                    while(optionsSet.size < 4) {
                        const randomItem = pool[Math.floor(Math.random() * pool.length)];
                        optionsSet.add(randomItem.meaning);
                    }
                    
                    // æ‰“ä¹±é€‰é¡¹
                    const options = Array.from(optionsSet).sort(() => Math.random() - 0.5);
                    const answerIndex = options.indexOf(correctItem.meaning);

                    return {
                        question: correctItem.main, // é¢˜ç›®æ˜¯æ—¥è¯­
                        hint: correctItem.kana || '',
                        options: options, // é€‰é¡¹æ˜¯ä¸­æ–‡æ„æ€
                        answer: answerIndex
                    };
                },
                rpgAnswer(idx) {
                    clearInterval(this.rpgGame.timerInterval);
                    const isCorrect = (idx === this.rpgGame.currentQ.answer);

                    if (isCorrect) {
                        // å¥–åŠ±é€»è¾‘
                        let reward = 0;
                        if (this.rpgGame.difficulty === 'easy') reward = 5;
                        else if (this.rpgGame.difficulty === 'normal') reward = 10;
                        else reward = 20;
                        
                        this.rpgGame.coinsEarned += reward;
                        this.rpgGame.streakInLevel++;
                        this.rpgNextQ();
                    } else {
                        // æƒ©ç½šé€»è¾‘
                        this.rpgGame.hp--;
                        this.rpgGame.shake = true; // å¼€å¯éœ‡åŠ¨åŠ¨ç”»
                        this.rpgGame.damageText = '-1 â¤ï¸'; // é£˜å­—
                        setTimeout(() => { this.rpgGame.shake = false; this.rpgGame.damageText = ''; }, 500);
                        
                        if (this.rpgGame.hp <= 0) {
                            setTimeout(() => this.rpgGameOver(), 800);
                        } else {
                            setTimeout(() => this.rpgNextQ(), 800);
                        }
                    }
                },
                rpgGameOver() {
                    this.rpgGame.state = 'result';
                    let penalty = 0;

                    // åªæœ‰ Boss å…³å¤±è´¥æ‰æ‰£é’±
                    if (this.rpgGame.isBoss) {
                        let rate = 0.2;
                        if (this.rpgGame.difficulty === 'normal') rate = 0.4;
                        if (this.rpgGame.difficulty === 'hard') rate = 0.6;
                        
                        // æ‰£é™¤æ€»é‡‘å¸çš„ç™¾åˆ†æ¯”
                        penalty = Math.floor(this.userCoins * rate);
                        if (penalty > this.userCoins) penalty = this.userCoins; // é˜²æ­¢è´Ÿæ•° (è™½ç„¶é€»è¾‘ä¸Šä¸ä¼š)
                    }

                    this.rpgGame.penalty = penalty;
                    
                    // ç»“ç®—: èµšçš„ - ç½šçš„
                    const finalChange = this.rpgGame.coinsEarned - penalty;
                    this.rpgGame.finalChange = finalChange;

                    // åº”ç”¨åˆ°è´¦æˆ·
                    this.userCoins += finalChange;
                    if (this.userCoins < 0) this.userCoins = 0; // ç ´äº§ä¿æŠ¤
                    
                    this.saveData();
                }
            }
        }).mount('#app');
    </script>
</body>
</html>